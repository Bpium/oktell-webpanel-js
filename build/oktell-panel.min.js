/* Oktell-panel.js 0.3.5 http://js.oktell.ru/webpanel */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var e,f=b||window.event,g=[].slice.call(arguments,1),h=0,i=0,j=0,k=0,l=0;return b=a.event.fix(f),b.type="oktellPanelMousewheel",f.wheelDelta&&(h=f.wheelDelta),f.detail&&(h=-1*f.detail),f.deltaY&&(j=-1*f.deltaY,h=j),f.deltaX&&(i=f.deltaX,h=-1*i),void 0!==f.wheelDeltaY&&(j=f.wheelDeltaY),void 0!==f.wheelDeltaX&&(i=-1*f.wheelDeltaX),k=Math.abs(h),(!c||c>k)&&(c=k),l=Math.max(Math.abs(j),Math.abs(i)),(!d||d>l)&&(d=l),e=h>0?"floor":"ceil",h=Math[e](h/c),i=Math[e](i/d),j=Math[e](j/d),g.unshift(b,h,i,j),(a.event.dispatch||a.event.handle).apply(this,g)}var c,d,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],f="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(a.event.fixHooks)for(var g=e.length;g;)a.event.fixHooks[e[--g]]=a.event.mouseHooks;a.event.special.oktellPanelMousewheel={setup:function(){if(this.addEventListener)for(var a=f.length;a;)this.addEventListener(f[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=f.length;a;)this.removeEventListener(f[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({oktellPanelMousewheel:function(a){return a?this.bind("oktellPanelMousewheel",a):this.trigger("oktellPanelMousewheel")},unOktellPanelMousewheel:function(a){return this.unbind("oktellPanelMousewheel",a)}})}),function(a){function b(){this===e.elem&&(e.pos=[-260,-260],e.elem=!1,f=3)}var c,d,e={pos:[-260,-260]},f=3,g=document,h=g.documentElement,i=g.body;a.event.special.oktellPanelMwheelIntent={setup:function(){var c=a(this).bind("oktellPanelMousewheel",a.event.special.oktellPanelMwheelIntent.handler);return this!==g&&this!==h&&this!==i&&c.bind("mouseleave",b),c=null,!0},teardown:function(){return a(this).unbind("oktellPanelMousewheel",a.event.special.oktellPanelMwheelIntent.handler).unbind("mouseleave",b),!0},handler:function(b){var g=[b.clientX,b.clientY];return this===e.elem||Math.abs(e.pos[0]-g[0])>f||Math.abs(e.pos[1]-g[1])>f?(e.elem=this,e.pos=g,f=250,clearTimeout(d),d=setTimeout(function(){f=10},200),clearTimeout(c),c=setTimeout(function(){f=3},1500),b=a.extend({},b,{type:"oktellPanelMwheelIntent"}),(a.event.dispatch||a.event.handle).apply(this,arguments)):void 0}},a.fn.extend({oktellPanelMwheelIntent:function(a){return a?this.bind("oktellPanelMwheelIntent",a):this.trigger("oktellPanelMwheelIntent")},unOktellPanelMwheelIntent:function(a){return this.unbind("oktellPanelMwheelIntent",a)}}),a(function(){i=g.body,a(g).bind("oktellPanelMwheelIntent.mwheelIntentDefault",a.noop)})}(jQuery),function(a,b,c){a.fn.oktellPanelJScrollPane=function(b){function d(b,d){function e(d){var e,g,k,l,m,n=!1,t=!1;if(w=d,x===c)l=b.scrollTop(),m=b.scrollLeft(),b.css({overflow:"hidden",padding:0}),y=b.innerWidth()+S,z=b.innerHeight(),b.width(y),x=a('<div class="jspPane" />').css("padding",R).append(b.children()),A=a('<div class="jspContainer" />').css({width:y+"px",height:z+"px"}).append(x).appendTo(b);else{if(b.css("width",""),n=w.stickToBottom&&q(),t=w.stickToRight&&isCloseToRight(),k=b.innerWidth()+S!=y||b.outerHeight()!=z,k&&(y=b.innerWidth()+S,z=b.innerHeight(),A.css({width:y+"px",height:z+"px"})),!k&&T==B&&x.outerHeight()==C)return void b.width(y);T=B,x.css("width",""),b.width(y),A.find(">.jspVerticalBar").remove().end()}x.css("overflow","auto"),B=d.contentWidth?d.contentWidth:x[0].scrollWidth,C=x[0].scrollHeight,x.css("overflow",""),D=B/y,E=C/z,F=E>1,F?(b.addClass("jspScrollable"),e=w.maintainPosition&&J,e&&(g=p()),f(),h(),e&&o(n?C-z:g,!1),r(),u(),w.clickOnTrack&&i()):(b.removeClass("jspScrollable"),x.css({top:0,width:A.width()-S}),s(),j()),l&&b.scrollTop(0)&&o(l,!1),b.trigger("jsp-initialised",[F])}function f(){F&&(A.append(a('<div class="jspVerticalBar" />').append(a('<div class="jspCap jspCapTop" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragTop" />'),a('<div class="jspDragBottom" />'),a('<div class="jspDragInner" />'))),a('<div class="jspCap jspCapBottom" />'))),K=A.find(">.jspVerticalBar"),L=K.find(">.jspTrack"),G=L.find(">.jspDrag"),H=G.find(">.jspDragInner"),A.unbind("mouseenter.jspInner"),A.unbind("mouseleave.jspInner"),w.dragInnerAnimation&&(A.bind("mouseenter.jspInner",function(){return H.stop(!0,!0),H.fadeIn(100),!0}),A.bind("mouseleave.jspInner",function(){H.stop(!0,!0),H.fadeOut(500)})),w.showArrows&&(P=a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",getArrowScroll(0,-1)).bind("click.jsp",t),Q=a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",getArrowScroll(0,1)).bind("click.jsp",t),w.arrowScrollOnHover&&(P.bind("mouseover.jsp",getArrowScroll(0,-1,P)),Q.bind("mouseover.jsp",getArrowScroll(0,1,Q))),appendArrows(L,w.verticalArrowPositions,P,Q)),N=z,A.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){N-=a(this).outerHeight()}),G.hover(function(){G.addClass("jspHover")},function(){G.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",t),G.addClass("jspActive");var c=b.pageY-G.position().top;return a("html").bind("mousemove.jsp",function(a){l(a.pageY-c,!1)}).bind("mouseup.jsp mouseleave.jsp",k),!1}),g())}function g(){L.height(N+"px"),J=0,M=w.verticalGutter+L.outerWidth(),x.width(y-M-S);try{0===K.position().left&&x.css("margin-left",M+"px")}catch(a){}}function h(){C=x.outerHeight(),E=C/z,F&&(O=Math.ceil(1/E*N),O>w.verticalDragMaxHeight?O=w.verticalDragMaxHeight:O<w.verticalDragMinHeight&&(O=w.verticalDragMinHeight),G.height(O+"px"),I=N-O,m(J))}function i(){j(),F&&L.bind("mousedown.jsp",function(b){if(b.originalTarget===c||b.originalTarget==b.currentTarget){var d,e=a(this),f=e.offset(),g=b.pageY-f.top-J,h=!0,i=function(){var a=e.offset(),c=b.pageY-a.top-O/2,f=z*w.scrollPagePercent,k=I*f/(C-z);if(0>g)J-k>c?U.scrollByY(-f):l(c);else{if(!(g>0))return void j();c>J+k?U.scrollByY(f):l(c)}d=setTimeout(i,h?w.initialDelay:w.trackClickRepeatFreq),h=!1},j=function(){d&&clearTimeout(d),d=null,a(document).unbind("mouseup.jsp",j)};return i(),a(document).bind("mouseup.jsp",j),!1}})}function j(){L&&L.unbind("mousedown.jsp")}function k(){a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),G&&G.removeClass("jspActive")}function l(a,b){F&&(0>a?a=0:a>I&&(a=I),b===c&&(b=w.animateScroll),b?U.animate(G,"top",a,m):(G.css("top",a),m(a)))}function m(a){a===c&&(a=G.position().top),A.scrollTop(0),J=a;var d=0===J,e=J==I,f=a/I,g=-f*(C-z);(V!=d||X!=e)&&(V=d,X=e,b.trigger("jsp-arrow-change",[V,X,W,Y])),n(d,e),x.css("top",g),b.trigger("jsp-scroll-y",[-g,d,e]).trigger("scroll")}function n(a,b){w.showArrows&&(P[a?"addClass":"removeClass"]("jspDisabled"),Q[b?"addClass":"removeClass"]("jspDisabled"))}function o(a,b){var c=a/(C-z);l(c*I,b)}function p(){return-x.position().top}function q(){var a=C-z;return a>20&&a-p()<10}function r(){A.unbind($).bind($,function(a,b,c,d){return U.scrollByY(-d*w.mouseWheelSpeed,!1),w.onScroll&&w.onScroll(),!1})}function s(){A.unbind($)}function t(){return!1}function u(){var a,b,c,d=!1;A.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(e){var f=e.originalEvent.touches[0];a=p(),b=f.pageY,c=!1,d=!0}).bind("touchmove.jsp",function(e){if(d){var f=e.originalEvent.touches[0];return U.scrollToY(a+b-f.pageY),c=c||Math.abs(b-f.pageY)>5,w.onScroll&&w.onScroll(),!1}}).bind("touchend.jsp",function(){d=!1}).bind("click.jsp-touchclick",function(){return c?(c=!1,!1):void 0})}function v(){var a=p();b.removeClass("jspScrollable").unbind(".jsp"),b.replaceWith(Z.append(x.children())),Z.scrollTop(a)}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U=this,V=!0,W=!0,X=!1,Y=!1,Z=b.clone(!1,!1).empty(),$=a.fn.oktellPanelMwheelIntent?"oktellPanelMwheelIntent.jsp":"oktellPanelMousewheel.jsp";R=b.css("paddingTop")+" "+b.css("paddingRight")+" "+b.css("paddingBottom")+" "+b.css("paddingLeft"),S=(parseInt(b.css("paddingLeft"),10)||0)+(parseInt(b.css("paddingRight"),10)||0),a.extend(U,{reinitialise:function(b){b=a.extend({},w,b),e(b)},scrollToY:function(a,b){o(a,b)},scrollToPercentY:function(a,b){o(a*(C-z),b)},scrollByY:function(a,b){var c=p()+Math[0>a?"floor":"ceil"](a),d=c/(C-z);l(d*I,b)},positionDragY:function(a,b){l(a,b)},animate:function(a,b,c,d){var e={};e[b]=c,a.animate(e,{duration:w.animateDuration,easing:w.animateEase,queue:!1,step:d})},getContentPositionY:function(){return p()},getContentWidth:function(){return B},getContentHeight:function(){return C},getPercentScrolledY:function(){return p()/(C-z)},getIsScrollableV:function(){return F},getContentPane:function(){return x},scrollToBottom:function(a){l(I,a)},destroy:function(){v()}}),e(d)}return b=a.extend({},a.fn.oktellPanelJScrollPane.defaults,b),a.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){b[this]=b[this]||b.speed}),this.each(function(){var c=a(this),e=c.data("jsp");e?e.reinitialise(b):(a("script",c).filter('[type="text/javascript"],:not([type])').remove(),e=new d(c,b),c.data("jsp",e))})},a.fn.oktellPanelJScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,contentWidth:c,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8,dragInnerAnimation:!0,onScroll:null}}(jQuery,this);var __slice=[].slice,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty;!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;if(!a)throw new d("Error init oktell panel, jQuery ( $ ) is not defined");return r=function(a,b,c){var d;return d="",function(){var e,f,g,h,i;return g=this,e=arguments,h=function(){var b;return d=null,c?void 0:b=a.apply(g,e)},f=c&&!d,clearTimeout(d),d=setTimeout(h,b),f&&(i=a.apply(g,e)),i}},w=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},F=function(){var a;try{return console.log.apply(console,arguments)}catch(b){a=b}},q=function(b,c,d){var e,f,g,h;return arguments.length>1&&"[object Object]"!==String(c)?(d=a.extend({},d),null==c&&(d.expires=-1),"number"==typeof d.expires&&(g=d.expires,h=d.expires=new Date,h.setSeconds(h.getSeconds()+g)),c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")):(d=c||{},f="",e=d.raw?function(a){return a}:decodeURIComponent,(f=new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)").exec(document.cookie))?e(f[1]):null)},H=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)})},f=function(){function a(a,b,c,d,e){var f;null==b&&(b=0),"string"==typeof a&&a&&0===window.webkitNotifications.checkPermission()&&("function"==typeof c?(e=c,c="",d=null):"function"==typeof d&&(e=d,d=null),f=window.webkitNotifications.createNotification("favicon.ico",a,c||""),d&&(f.tag=d),f.show(),b=parseInt(b),b&&setTimeout(function(){return f.close()},1e3*b),f.onclick=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],"function"==typeof window.focus&&window.focus(),f.close(),"function"==typeof e?e.apply(window,[]):void 0},this.close=function(){return null!=f&&"function"==typeof f.close?f.close():void 0})}return a}(),c=function(){function b(a,b){this.usersVisibilityCss="invisibleDep",this.lastFilteredUsers=[],this.isSorted=!1,this.visible=!0,this.users=[],this.id=a&&"00000000-0000-0000-0000-000000000000"!==a?a:this.withoutDepName,this.name=this.id!==this.withoutDepName&&b?b:this.langs.panel.withoutDepartment,this.isOpen=null!=this.config().departmentVisibility[this.id]?this.config().departmentVisibility[this.id]:!0}return b.prototype.logGroup="Department",b.prototype.getEl=function(b){return this.el||(this.el=a(this.template.replace(/\{\{department}\}/g,w(this.name)))),b?(this._oldIsOpen=this.isOpen,this.showUsers(!0,!0)):this.showUsers(null!=this._oldIsOpen?this._oldIsOpen:this.isOpen),this.el.data("department",this),this.el},b.prototype.getContainer=function(){return this.el.find("tbody")},b.prototype.showUsers=function(a,b){var c;return"undefined"==typeof a&&(a=!this.isOpen),this.hideEl||(this.hideEl=this.el.find("table")),this.hideEl.stop(!0,!0),b||(this.isOpen=a,c=this.config(),c.departmentVisibility[this.id]=this.isOpen,this.config(c)),a?(this.el.toggleClass(this.usersVisibilityCss,!1),this.hideEl.show()):(this.el.toggleClass(this.usersVisibilityCss,!0),this.hideEl.hide())},b.prototype.getInfo=function(){return this.name+" "+this.id},b.prototype.clearUsers=function(){return this.users=[]},b.prototype.show=function(a){return this.el&&!this.visible?(a?this.el.slideDown(200):this.el.show(),this.visible=!0):void 0},b.prototype.hide=function(a){return this.el&&this.visible?(a?this.el.slideUp(200):this.el.hide(),this.visible=!1):void 0},b.prototype.getUsers=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;if(this.isSorted||this.sortUsers(),f=[],d=!1,""===a)if(b)for(m=this.users,g=0,j=m.length;j>g;g++)e=m[g],e.setSelection(),f.push(e);else for(n=this.users,h=0,k=n.length;k>h;h++)e=n[h],0!==e.state&&(e.setSelection(),f.push(e));else for(o=this.users,i=0,l=o.length;l>i;i++)e=o[i],e.isFiltered(a,b,c)&&(f.push(e),e.number!==a||d||(d=e));return this.lastFilteredUsers=f,[f,d]},b.prototype.sortUsers=function(){return this.users.sort(this.sortFn)},b.prototype.sortFn=function(a,b){return a.nameLower>b.nameLower?1:a.nameLower<b.nameLower?-1:a.number>b.number?1:a.number<b.number?-1:0},b.prototype.addUser=function(a){return a.number?this.users.push(a):void 0},b}(),b=function(){function b(b){this.doAction=__bind(this.doAction,this),this.state=!1,this.additionalActions={},this.hasHover=!1,this.buttonLastAction="",this.firstLiCssPrefix="m_button_action_",this.noneActionCss="",this.els=a(),this.buttonEls=a(),this.init(b)}return b.prototype.logGroup="User",b.prototype.init=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;return this.id=null!=(d=a.id)?d.toString().toLowerCase():void 0,this.isFantom=a.isFantom||!1,this.number=(null!=(e=a.number)?e.toString():void 0)||"",this.number||(this.invisible=!0),this.numberFormatted=(null!=(f=a.numberFormatted)?f.toString():void 0)||this.number,this.numberHtml=w(this.numberFormatted),this.name=(null!=(g=a.name)?g.toString():void 0)||"",this.nameLower=this.name.toLowerCase(),this.letter=(null!=(h=this.name[0])?h.toUpperCase():void 0)||(null!=(i=this.number)?i[0].toString().toLowerCase():void 0),this.nameHtml=a.name&&a.name.toString()!==this.number?w(a.name):this.numberHtml,this.numberHtml===this.nameHtml&&(this.numberHtml=""),this.isIvr=a.isIvr,this.ivrName=a.ivrName,c=this.nameHtml.split(/\s+/),c.length>1&&this.name.toString()!==this.number?(this.nameHtml1=c[0],this.nameHtml2=" "+c.splice(1).join(" ")):(this.nameHtml1=this.nameHtml,this.nameHtml2=""),b=this.elNumberHtml,this.elNumberHtml=this.numberHtml!==this.nameHtml?this.numberHtml:"",this.elNumberHtml!==b&&null!=this.el&&this.el.find(".o_number").text(this.elNumberHtml),null!=(j=this.el)&&j.find(".b_contact_title wrapword a").text(this.nameHtml),this.avatarLink32x32=a.avatarLink32x32||this.defaultAvatar32||"",this.defaultAvatarCss=this.avatarLink32x32?"":"m_default",this.departmentId=(null!=a&&null!=(k=a.numberObj)?k.departmentid:void 0)&&"00000000-0000-0000-0000-000000000000"!==(null!=a?a.numberObj.departmentid:void 0)?null!=a?a.numberObj.departmentid:void 0:this.withoutDepName,this.department="www_without"===this.departmentId?this.langs.panel.withoutDepartment:null!=a&&null!=(l=a.numberObj)?l.department:void 0,this.setState(null!=(null!=(m=a.numberObj)?m.state:void 0)?a.numberObj.state:null!=a.state?a.state:1),this.loadActions()},b.prototype.regexps={name:/\{\{name\}\}/,name1:/\{\{name1\}\}/,name2:/\{\{name2\}\}/,number:/\{\{number\}\}/,dtmf:/\{\{dtmf\}\}/,avatarLink32x32:/\{\{avatarLink32x32\}\}/,css:/\{\{css\}\}/,letter:/\{\{letter\}\}/},b.prototype.setState=function(a){var b=this;return a=parseInt(a),a!==this.state?(this.state=a,this.setStateCss(),this.buttonEls.length?(this.loadActions(),setTimeout(function(){return b.loadActions()},100)):void 0):void 0},b.prototype.setStateCss=function(){return this.els.length?(this.els.toggleClass("m_busy",5===this.state),this.els.toggleClass("m_offline",0===this.state),this.els.toggleClass("m_break",2===this.state),this.els.toggleClass("m_dnd",3===this.state)):void 0},b.prototype.getInfo=function(){return'"'+this.number+'" '+this.state+" "+this.name},b.prototype.isFiltered=function(a,b,c){var d;return a&&"string"==typeof a||!b&&(b||0===this.state)?b||!b&&0!==this.state?this.number&&-1!==this.number.indexOf(a)||-1!==(" "+this.name).toLowerCase().indexOf(a)?(this.setSelection(a),!0):"en"===c&&(d=this.toRu(a))&&-1!==(" "+this.name).toLowerCase().indexOf(d)?(this.setSelection(d),!0):"ru"===c&&(d=this.toEn(a))&&-1!==(" "+this.name).toLowerCase().indexOf(d)?(this.setSelection(d),!0):!1:!1:(this.setSelection(),!0)},b.prototype.showLetter=function(a){var b;return null!=(b=this.el)?b.find(".b_capital_letter span").text(a?this.letter:""):void 0},b.prototype.getEl=function(b){var c,d;return(!this.el||b)&&(d=this.template.replace(this.regexps.name1,this.nameHtml1).replace(this.regexps.name2,this.nameHtml2).replace(this.regexps.name,this.name+(this.numberHtml?" ("+this.numberHtml+")":"")).replace(this.regexps.number,this.numberHtml).replace(this.regexps.dtmf,this.langs.panel.dtmf).replace(this.regexps.avatarLink32x32,this.avatarLink32x32).replace(this.regexps.css,this.defaultAvatarCss),c=a(d),c.data("user",this),this.initButtonEl(c.find(".oktell_button_action")),this.els=this.els.add(c),this.setStateCss(),this.el||(this.el=c,this.elName=this.el.find(".b_contact_name b"),this.elName2=this.el.find(".b_contact_name span"),this.elNumber=this.el.find(".o_number"),this.elDtmf=this.el.find(".o_dtmf"))),c=c||this.el},b.prototype.setSelection=function(a){var b;if(null!=this.el){if(a)return b=new RegExp("("+a+")","gi"),this.elName.html(this.nameHtml1.replace(b,'<span class="selected_text">$1</span>')),this.elName2.html(this.nameHtml2.replace(b,'<span class="selected_text">$1</span>')),this.elNumber.html(this.numberHtml.replace(b,'<span class="selected_text">$1</span>')),this.elHasSelection=!0;if(this.elHasSelection)return this.elName.text(this.nameHtml1),this.elName2.text(this.nameHtml2),this.elNumber.text(this.numberHtml),this.elHasSelection=!1}},b.prototype.initButtonEl=function(a){var b=this;return this.buttonEls=this.buttonEls.add(a),a.data("user",this),a.children(":first").bind("click",function(){return b.doAction(b.buttonLastAction)}),this.buttonLastAction?a.removeClass(this.noneActionCss).addClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase()):a.addClass(this.noneActionCss)},b.prototype.getButtonEl=function(){var b;return b=a(this.buttonTemplate),this.initButtonEl(b),b},b.prototype.isHovered=function(a){return this.hasHover!==a?(this.hasHover=a,this.hasHover?this.loadActions(!0):void 0):void 0},b.prototype.loadOktellActions=function(){var a,b,c;b=this.isIvr?["endCall"]:this.oktell.getPhoneActions(this.number||this.id),c=this.additionalActions;for(a in c)__hasProp.call(c,a)&&b.push(a);return b},b.prototype.addAction=function(a,b){return a&&"string"==typeof a&&"function"==typeof b?this.additionalActions[a]=b:void 0},b.prototype.removeAction=function(a){return a&&delete this.additionalActions[a]},b.prototype.loadActions=function(){var a,b,c;b=this.loadOktellActions(),c=this.additionalActions;for(a in c)__hasProp.call(c,a)&&b.push(a);return a=(null!=b?b[0]:void 0)||"",this.buttonLastAction===a?b:(this.buttonLastAction&&this.buttonEls.removeClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase()),a?(this.buttonLastAction=a,this.buttonEls.removeClass(this.noneActionCss).addClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase())):(this.buttonLastAction="",this.buttonEls.addClass(this.noneActionCss)),b)},b.prototype.doAction=function(a){var b,c,d,e,f;if(a)switch(b=this.number,"function"==typeof this.beforeAction&&this.beforeAction(a),a){case"call":return this.oktell.call(b);case"conference":return this.oktell.conference(b);case"intercom":return this.oktell.intercom(b);case"transfer":return this.oktell.transfer(b);case"toggle":return this.oktell.toggle();case"ghostListen":return this.oktell.ghostListen(b);case"ghostHelp":return this.oktell.ghostHelp(b);case"ghostConference":return this.oktell.ghostConference(b);case"endCall":return this.oktell.endCall(b);case"hold":return"function"==typeof(c=this.oktell).hold?c.hold():void 0;case"resume":return"function"==typeof(d=this.oktell).resume?d.resume():void 0;case"answer":return"function"==typeof(e=this.oktell).answer?e.answer():void 0;default:return"function"==typeof(f=this.additionalActions)[a]?f[a]():void 0}},b.prototype.doLastFirstAction=function(){return this.buttonLastAction?(this.doAction(this.buttonLastAction),!0):!1},b.prototype.letterVisibility=function(a){return this.el&&this.el.length?this.el.find(".b_capital_letter span").text(a?this.letter:""):void 0},b.prototype.replacerToRu={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."},b.prototype.replacerToEn={й:"q",ц:"w",у:"e",к:"r",е:"t",н:"y",г:"u",ш:"i",щ:"o",з:"p",х:"[",ъ:"]",ф:"a",ы:"s",в:"d",а:"f",п:"g",р:"h",о:"j",л:"k",д:"l",ж:";",э:"'",я:"z",ч:"x",с:"c",м:"v",и:"b",т:"n",ь:"m",б:",",ю:".",".":"/"},b.prototype.toRu=function(a){var b=this;return a.replace(/[A-z\/,.;\'\]\[]/g,function(a){return a===a.toLowerCase()?b.replacerToRu[a]:b.replacerToRu[a.toLowerCase()].toUpperCase()})},b.prototype.toEn=function(a){var b=this;return a.replace(/[А-яёЁ]/g,function(a){return a===a.toLowerCase()?b.replacerToEn[a]:b.replacerToEn[a.toLowerCase()].toUpperCase()})},b}(),e=function(){function d(d,e,g,h,i,j,k,l,m){this.onPbxNumberStateChange=__bind(this.onPbxNumberStateChange,this);var n,o,p,q,s,t,u=this;this.defaultConfig={departmentVisibility:{},showDeps:!0,showOffline:!1},this.useNativeScroll=l,this.stickyHeaders=k,this.jScrollPaneParams={mouseWheelSpeed:50,hideFocus:!0,verticalGutter:-13},this.allActions={answer:{icon:"/img/icons/action/call.png",iconWhite:"/img/icons/action/white/call.png",text:this.langs.actions.answer},call:{icon:"/img/icons/action/call.png",iconWhite:"/img/icons/action/white/call.png",text:this.langs.actions.call},conference:{icon:"/img/icons/action/confinvite.png",iconWhite:"/img/icons/action/white/confinvite.png",text:this.langs.actions.conference},transfer:{icon:"/img/icons/action/transfer.png",text:this.langs.actions.transfer},toggle:{icon:"/img/icons/action/toggle.png",text:this.langs.actions.toggle},intercom:{icon:"/img/icons/action/intercom.png",text:this.langs.actions.intercom},endCall:{icon:"/img/icons/action/endcall.png",iconWhite:"/img/icons/action/white/endcall.png",text:this.langs.actions.endCall},ghostListen:{icon:"/img/icons/action/ghost_monitor.png",text:this.langs.actions.ghostListen},ghostHelp:{icon:"/img/icons/action/ghost_help.png",text:this.langs.actions.ghostHelp},hold:{icon:"/img/icons/action/ghost_help.png",text:this.langs.actions.hold},resume:{icon:"/img/icons/action/ghost_help.png",text:this.langs.actions.resume},dtmf:{icon:"",text:this.langs.actions.dtmf}},this.actionCssPrefix="i_",this.lastDropdownUser=!1,t=this,b.prototype.beforeAction=function(a){return t.beforeUserAction(this,a)},this.departments=[],this.departmentsById={},this.simpleListEl=a(this.usersTableTemplate),this.filterFantomUserNumber=!1,this.userWithGeneratedButtons={},this.debugMode=m,this.dropdownPaddingBottomLeft=3,this.dropdownOpenedOnPanel=!1,this.regexps={actionText:/\{\{actionText\}\}/,action:/\{\{action\}\}/,css:/\{\{css\}\}/,dep:/\{\{department}\}/g},q=!1,this.options=i,this.contained=j,this.usersByNumber={},this.me=!1,this.oktell=d,this.panelUsers=[],this.panelUsersFiltered=[],this.abonents={},this.hold={},this.queue={},this.oktell=d,b.prototype.oktell=d,this.filter=!1,this.panelEl=e,this.dtmfEl=this.panelEl.find(".i_extension"),this.dropdownEl=g,this.dropdownElLiTemplate=this.dropdownEl.html(),this.dropdownEl.empty(),this.keypadEl=this.panelEl.find(".j_phone_keypad"),this.keypadIsVisible=!1,this.usersListBlockEl=this.panelEl.find(".j_main_list"),this.scrollContainer="",this.scrollContent="",this.usersListEl=this.simpleListEl.find("tbody"),this.abonentsListBlock=this.panelEl.find(".j_abonents"),this.abonentsListEl=this.abonentsListBlock.find("tbody"),this.abonentsHeaderTextEl=this.abonentsListBlock.find("b_marks_label"),this.talkTimeEl=this.abonentsListBlock.find(".b_marks_time"),this.holdBlockEl=this.panelEl.find(".j_hold"),this.holdListEl=this.holdBlockEl.find("tbody"),this.queueBlockEl=this.panelEl.find(".j_queue"),this.queueListEl=this.queueBlockEl.find("tbody"),this.filterInput=this.panelEl.find("input"),this.filterClearCross=this.panelEl.find(".jInputClear_close"),n=!1,this.buttonShowOffline=this.panelEl.find(".b_list_filter .i_online"),this.buttonShowDeps=this.panelEl.find(".b_list_filter .i_group"),this.buttonShowOffline.bind("click",function(){return u.config({showOffline:!u.showOffline}),u.setFilter(u.filter,!0)}),this.buttonShowDeps.bind("click",function(){return u.config({showDeps:!u.showDeps}),u.setFilter(u.filter,!0)}),this.dtmfEl.find(".o_close").bind("click",function(){return u.hideDtmf()}),this.dtmfEl.find(".btn-small").bind("click",function(b){return u.sendDtmf(a(b.target).text())}),this.usersWithBeforeConnectButtons=[],this.config(),c.prototype.config=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],u.config.apply(u,a)},this.allUserDep=new c("all_user_dep","allUsers"),this.allUserDep.template=this.usersTableTemplate,this.exactMatchUserDep=new c("exact_match_user_dep","exactUser"),this.exactMatchUserDep.template=this.usersTableTemplate,this.initJScrollPane=function(){return u.useNativeScroll?(u.scrollContainer=u.usersListBlockEl,u.scrollContent=u.usersListBlockEl,u.usersListBlockEl.css("overflow-y","auto")):(u.usersListBlockEl.oktellPanelJScrollPane(u.jScrollPaneParams),u.jScrollPaneAPI=u.usersListBlockEl.data("jsp"),u.scrollContainer=u.usersListBlockEl.find(".jspContainer"),u.scrollContent=u.usersListBlockEl.find(".jspPane")),u.stickyHeaders?u.usersListBlockEl.bind("scroll",function(){return u.processStickyHeaders()}):void 0},this.initJScrollPane(),this.reinitScroll=function(){var a;return u.useNativeScroll?void 0:null!=(a=u.jScrollPaneAPI)?a.reinitialise():void 0},this.resetDepsWidth=function(){var a,b;return u.useNativeScroll||u.contained||!u.scrollContent?void 0:(a=parseInt(u.scrollContent.css("width")),u.scrollContent.find(".b_department").css("width",a+"px"),null!=(b=u.currentTopHeaderClone)?b.css({width:a+"px"}):void 0)},this.userScrollerToTop=function(){return u.useNativeScroll?u.usersListBlockEl.scrollTop(0):u.jScrollPaneAPI.scrollToY(0)},this.filterClearCross.bind("click",function(){return u.clearFilter()}),this.filterInput.bind("keyup",function(a){return u.oktellConnected?(n||(n=r(function(){return u.setFilter(u.filterInput.val().toString().toLowerCase())},100)),u.filterInput.val()?u.filterClearCross.show():u.filterClearCross.hide(),13===a.keyCode?(u.filterInput.blur(),setTimeout(function(){var a;return null!=(a=u.scrollContent.find("tr:first").data("user"))&&a.doLastFirstAction(),u.clearFilter()},50)):n(),!0):!0}),this.panelEl.bind("click",function(b){var c,d,e,f,g,h;return f=a(b.target),f.is(".b_department_header")||f.parents(".b_department_header").size()>0?(e=f.parents(".b_department").data("department"),null!=(null!=e?e.showUsers:void 0)&&(e.showUsers(),u.clearSelection(),u.reinitScroll()),u.setUserListHeight(),!1):f.is(".o_dtmf")?(u.showDtmf(),!1):(f.is(".oktell_button_action .g_first")?c=f.parent():f.is(".oktell_button_action .g_first i")?c=f.parent().parent():f.is(".b_contact .drop_down")?d=f.parent():f.is(".b_contact .drop_down i")&&(d=f.parent().parent()),null==c&&null==d||c&&0===c.size()||d&&0===d.size()?!0:null!=c&&c.size()?!0:null!=d&&d.size()?(h=d.data("user"),g=d.parents(".j_abonents").size(),h&&u.showDropdown(h,d,h.loadOktellActions(),!0,g),!0):void 0)}),this.dropdownEl.bind("click",function(b){var c,d,e,f;if(e=a(b.target),e.is("[data-action]"))d=e;else{if(0===e.closest("[data-action]").size())return!0;d=e.closest("[data-action]")}return(c=d.data("action"))?(f=u.dropdownEl.data("user"),c&&f&&("dtmf"===c?u.toggleDtmf():f.doAction(c)),u.dropdownEl.hide()):void 0}),p="",this.dropdownEl.hover(function(){return clearTimeout(p)},function(){return p=setTimeout(function(){return u.hideActionListDropdown()},500)}),this.panelEl.find(".j_keypad_expand").bind("click",function(){return u.toggleKeypadVisibility(),u.filterInput.focus()}),this.keypadEl.find("li").bind("click",function(b){return u.filterInput.focus(),u.filterInput.val(u.filterInput.val()+a(b.currentTarget).find("button").data("num")),u.filterInput.keyup()}),this.setUserListHeight=function(){var b;return b=a(window).height()-u.usersListBlockEl[0].offsetTop+"px",u.usersListBlockEl.css({height:b}),u.reinitScroll(),u.resetDepsWidth()},this.setUserListHeight(),o=r(function(){return u.userScrollerToTop(),u.setUserListHeight()},150),a(window).bind("resize",function(){return o()}),this.options.hideOnDisconnect&&this.hidePanel(!0),d.on("webphoneConnect",function(){return u.panelEl.addClass("webphone")}),d.on("webphoneDisconnect",function(){return u.panelEl.removeClass("webphone")}),d.on("disconnect",function(){var a,b,c,d;u.options.hideOnDisconnect&&u.hidePanel(),u.resetStickyHeaders(),u.oktellConnected=!1,u.usersByNumber={},u.panelUsers=[],u.setPanelUsersHtml([]),u.setAbonents([]),u.setHold({hasHold:!1}),u.filterInput.val(""),u.setFilter("",!0),u.setQueue([]),c=u.userWithGeneratedButtons,d=[];for(a in c)b=c[a],d.push(b.loadActions());return d}),d.on("connect",function(){var a,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,v,w;u.oktellConnected=!0,k=d.getMyInfo(),k.userid=k.userid.toString().toLowerCase(),u.myNumber=null!=(t=k.number)?t.toString():void 0,b.prototype.defaultAvatar=k.defaultAvatar,b.prototype.defaultAvatar32=k.defaultAvatar32x32,b.prototype.defaultAvatar64=k.defaultAvatar64x64,u.departments=[],u.departmentsById={},a={},o=new c,n=d.getUsers(),l=d.getNumbers();for(f in n)__hasProp.call(n,f)&&(q=n[f],delete l[q.number]);for(i in l)__hasProp.call(l,i)&&(g=l[i],f=H(),n[f]={id:f,number:i,name:g.caption,numberObj:g});for(j in n)__hasProp.call(n,j)&&(m=n[j],p=(null!=(v=m.number)?v.toString():void 0)||"",p&&(u.usersByNumber[p]?(q=u.usersByNumber[p],m.isFantom=!1,q.init(m)):(q=new b(m),q.number&&(u.usersByNumber[q.number]=q)),q.id!==k.userid?(u.panelUsers.push(q),q.departmentId&&"00000000-0000-0000-0000-000000000000"!==q.departmentId&&q.departmentId!==u.withoutDepName?(a[q.departmentId]?e=a[q.departmentId]:(e=a[q.departmentId]=new c(q.departmentId,q.department),u.departments.push(e),u.departmentsById[q.departmentId]=e),e.addUser(q)):o.addUser(q),u.allUserDep.addUser(q)):u.me=q));for(u.departments.sort(function(a,b){return a.name>b.name?1:b.name>a.name?-1:0}),u.departments.push(o),u.departmentsById[o.id]=o,d.offNativeEvent("pbxnumberstatechanged",u.onPbxNumberStateChange),d.onNativeEvent("pbxnumberstatechanged",u.onPbxNumberStateChange),setTimeout(function(){return u.setAbonents(d.getAbonents()),u.setHold(d.getHoldInfo())},1e3),u.setFilter("",!0),setTimeout(function(){return u.setUserListHeight()
},500),d.getQueue(function(a){return a.result?u.setQueue(a.queue):void 0}),w=u.usersWithBeforeConnectButtons,r=0,s=w.length;s>r;r++)q=w[r],q.loadActions();return u.contained||u.options.hideOnDisconnect?u.showPanel():u.panelEl.show(),u.setTalking("talk"===d.getState()),"function"==typeof h?h():void 0}),d.on("abonentsChange",function(a){return u.oktellConnected?(d.conferenceId()?(u.panelEl.addClass("conference"),u.hideDtmf()):u.panelEl.removeClass("conference"),u.setAbonents(a),u.reloadActions()):void 0}),d.on("holdStateChange",function(a){return u.oktellConnected?(u.setHold(a),u.reloadActions()):void 0}),d.on("talkTimer",function(a,b){return u.oktellConnected?u.talkTimeEl.text(a===!1?"":b):void 0}),d.on("stateChange",function(a){return u.oktellConnected?(u.reloadActions(),u.setTalking("talk"===a)):void 0}),d.on("queueChange",function(a){return u.oktellConnected?u.setQueue(a):void 0}),d.on("connectError",function(){return u.options.hideOnDisconnect?void 0:u.showPanel()}),s=null,d.on("ringStart",function(){return u.options.useNotifies?s=new f(u.langs.callPopup.title):void 0}),d.on("ringStop",function(){return null!=s&&"function"==typeof s.close&&s.close(),s=null})}return d.prototype.logGroup="List",d.prototype.clearSelection=function(){var a;return document.selection&&document.selection.empty?document.selection.empty():window.getSelection?(a=window.getSelection(),a.removeAllRanges()):void 0},d.prototype.initStickyHeaders=function(){var b,c,d,e,f,g,h,i,j,k=this;if(this.stickyHeaders&&(this.resetStickyHeaders(),this.oktellConnected&&(this.headerEls=this.usersListBlockEl.find(".b_department_header").toArray(),0!==this.headerEls.length))){if(0===a(this.headerEls[0]).width())return void setTimeout(function(){return k.initStickyHeaders()},500);for(this.headerFisrt=this.headerEls[0],this.headerLast=this.headerEls.length?this.headerEls[this.headerEls.length-1]:null,i=this.headerEls,d=e=0,g=i.length;g>e;d=++e)c=i[d],this.headerEls[d]=a(c);for(b=this.scrollContainer.offset().top,j=this.headerEls,d=f=0,h=j.length;h>f;d=++f)if(c=j[d],c.offset().top>b||d===this.headerEls.length-1){this.processStickyHeaders(d-1);break}return this.processStickyHeaders()}},d.prototype.headerHeight=24,d.prototype.cloneHeaderHeight=null,d.prototype.processStickyHeaders=function(b){var c,d,e,f,g,h=this;if((null!=(f=this.headerEls)?f.length:void 0)>0){if(null!=b)return 0>b&&(b=0),this.currentTopIndex=b,null!=(g=this.currentTopHeaderClone)&&g.remove(),this.currentTopHeaderClone=this.headerEls[this.currentTopIndex].clone(),this.cloneHeaderHeight=this.headerEls[this.currentTopIndex].height(),this.currentTopHeaderClone.addClass("b_sticky_header"),this.currentTopHeaderClone.bind("click",function(){return h.headerEls[h.currentTopIndex].click(),h.initStickyHeaders(),h.reinitScroll()}),a(".b_sticky_header_container").empty().append(this.currentTopHeaderClone),this.currentTopHeaderClone.offset({top:this.scrollContainer.offset().top}),this.processStickyHeaders();if(null!=this.currentTopIndex)if(c=this.scrollContainer.offset().top,d=this.headerEls[this.currentTopIndex].offset().top,d>c){if(0!==this.currentTopIndex)return this.processStickyHeaders(this.currentTopIndex-1);if(!this.currentTopHeaderClone.data("hidden"))return this.currentTopHeaderClone.data("hidden",!0),this.currentTopHeaderClone.hide()}else if(this.currentTopHeaderClone.data("hidden")&&(this.currentTopHeaderClone.data("hidden",!1),this.currentTopHeaderClone.show()),this.headerEls[this.currentTopIndex+1]){if(e=this.headerEls[this.currentTopIndex+1].offset().top,e>c+(this.cloneHeaderHeight||this.headerHeight))return this.currentTopHeaderClone.offset({top:c});if(e>c)return this.currentTopHeaderClone.offset({top:e-(this.cloneHeaderHeight||this.headerHeight)});if(c>e)return this.processStickyHeaders(this.currentTopIndex+1)}}},d.prototype.resetStickyHeaders=function(){var a;return null!=(a=this.currentTopHeaderClone)&&"function"==typeof a.remove&&a.remove(),this.currentTopHeaderClone=null,this.cloneHeaderHeight=null,this.currentTopIndex=null,this.headerEls=null},d.prototype.beforeShow=function(){},d.prototype.afterShow=function(){return this.initStickyHeaders()},d.prototype.beforeHide=function(){},d.prototype.afterHide=function(){return this.resetStickyHeaders()},d.prototype.setTalking=function(a){return a?this.panelEl.addClass("talking"):(this.hideDtmf(),this.panelEl.removeClass("talking"))},d.prototype.sendDtmf=function(a){return this.oktell.dtmf(a.toString().replace("∗","*"))},d.prototype.toggleDtmf=function(){return this.panelEl.hasClass("dtmf")?this.hideDtmf():this.showDtmf()},d.prototype.showDtmf=function(a){var b=this;return"talk"===this.oktell.getState()&&this.panelEl.hasClass("webphone")&&!this.panelEl.hasClass("dtmf")?(this.panelEl.addClass("dtmf"),this.dtmfEl.stop(!0,!0),a?(this.dtmfEl.show(),this.initStickyHeaders()):(this.resetStickyHeaders(),this.dtmfEl.slideDown(200,function(){return b.initStickyHeaders()}))):void 0},d.prototype.hideDtmf=function(a){var b=this;return this.panelEl.hasClass("dtmf")?(this.panelEl.removeClass("dtmf"),this.dtmfEl.stop(!0,!0),a?(this.dtmfEl.hide(),this.initStickyHeaders()):(this.resetStickyHeaders(),this.dtmfEl.slideUp(200,function(){return b.initStickyHeaders()}))):void 0},d.prototype.onPbxNumberStateChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(k=a.numbers,q=[],i=0,j=k.length;j>i;i++)d=k[i],e=d.num.toString(),f=this.usersByNumber[e],f?(b=null,b=this.showDeps?this.departmentsById[f.departmentId]:this.allUserDep,h=f.isFiltered(this.filter,this.showOffline,this.filterLang),f.setState(d.numstateid),g=f.isFiltered(this.filter,this.showOffline,this.filterLang),g?h?q.push(void 0):(b.getUsers(this.filter,this.showOffline,this.filterLang),c=b.lastFilteredUsers.indexOf(f),-1!==c?b.getContainer().is(":visible")?(0===c?b.getContainer().prepend(f.getEl()):null!=(m=b.lastFilteredUsers[c-1])&&null!=(n=m.el)&&n.after(f.getEl()),q.push((null!=(o=b.lastFilteredUsers[c-1])?o.letter:void 0)===f.letter?f.letterVisibility(!1):(null!=(p=b.lastFilteredUsers[c+1])?p.letter:void 0)===f.letter?b.lastFilteredUsers[c+1].letterVisibility(!1):void 0)):q.push(this.setFilter(this.filter,!0,!0)):q.push(void 0)):q.push(1===b.getContainer().children().length?this.setFilter(this.filter,!0,!0):null!=(l=f.el)&&"function"==typeof l.detach?l.detach():void 0)):q.push(void 0);return q},d.prototype.hideActionListDropdown=function(){var a=this;return this.dropdownEl.fadeOut(150,function(){return a.dropdownOpenedOnPanel=!1})},d.prototype.showPanel=function(a){var b,c=this;return this.contained?a?this.panelEl.show():this.panelEl.fadeIn(200):(b=this.panelEl.data("width"),b>0&&this.panelEl.data("hided")?(this.panelEl.data("width",b),this.panelEl.data("hided",!1),this.panelEl.css({display:""}),a?this.panelEl.css({overflow:"",width:b+"px"}):this.panelEl.animate({width:b+"px"},200,function(){return c.panelEl.css({overflow:""})})):void 0)},d.prototype.hidePanel=function(a){var b,c=this;return this.contained?a?this.panelEl.hide():this.panelEl.fadeOut(200):(b=null!=this.panelEl.data("width")?this.panelEl.data("width"):this.panelEl.width(),b>0&&!this.panelEl.data("hided")?(this.panelEl.data("width",b),this.panelEl.data("hided",!0),a?this.panelEl.css({display:"",overflow:"hidden",width:"0px"}):this.panelEl.animate({width:"0px"},200,function(){return c.panelEl.css({display:"",overflow:"hidden"})})):void 0)},d.prototype.getUserButtonForPlugin=function(a){var b,c,d=this;return c=this.getUser(a),this.oktellConnected||this.usersWithBeforeConnectButtons.push(c),this.userWithGeneratedButtons[a]=c,b=c.getButtonEl(),b.find(".drop_down").bind("click",function(){var a;return a=c.loadActions(),d.showDropdown(c,b,a)}),b},d.prototype.clearFilter=function(){return this.filterInput.val(""),this.setFilter(""),this.filterInput.keyup()},d.prototype.toggleKeypadVisibility=function(){return this.setKeypadVisibility(!this.keypadIsVisible)},d.prototype.setKeypadVisibility=function(a){var b=this;return null!=a&&Boolean(this.keypadIsVisible)!==Boolean(a)?(this.keypadIsVisible=Boolean(a),this.keypadEl.stop(!0,!0),this.resetStickyHeaders(),this.keypadIsVisible?this.keypadEl.slideDown({duration:200,easing:"linear",done:function(){return b.setUserListHeight(),b.initStickyHeaders()}}):this.keypadEl.slideUp({duration:200,easing:"linear",done:function(){return b.setUserListHeight(),b.initStickyHeaders()}})):void 0},d.prototype.addEventListenersForButton=function(b,c){var d=this;return c.bind("click",function(){return b?d.showDropdown(b,a(d)):void 0})},d.prototype.showDropdown=function(b,c,d,e,f){var g,h,i,j,k,l;if(i=this.dropdownElLiTemplate,this.dropdownEl.empty(),f&&!this.oktell.conferenceId()&&d.push("dtmf"),null!=d?!d.length:!0)return this.dropdownEl.hide();for(h=[],j=0,k=d.length;k>j;j++)g=d[j],"string"==typeof g&&(null!=(l=this.allActions[g])?l.text:void 0)&&h.push(i.replace(this.regexps.actionText,this.allActions[g].text).replace(this.regexps.action,g).replace(this.regexps.css,this.actionCssPrefix+g.toLowerCase()));return h.length?(this.dropdownEl.append(h.join("")),this.dropdownEl.children("li:first").addClass("g_first"),this.dropdownEl.children("li:last").addClass("g_last"),this.dropdownEl.data("user",b),this.dropdownEl.css({top:this.dropdownEl.height()+c.offset().top>a(window).height()?a(window).height()-this.dropdownEl.height()-this.dropdownPaddingBottomLeft:c.offset().top,left:Math.max(this.dropdownPaddingBottomLeft,c.offset().left-this.dropdownEl.width()+c.width()),visibility:"visible"}),this.dropdownEl.fadeIn(100),e?this.dropdownOpenedOnPanel=!0:void 0):this.dropdownEl.hide()},d.prototype.logUsers=function(){var a,b,c,d;c=this.panelUsersFiltered,d=[];for(a in c)__hasProp.call(c,a)&&(b=c[a],d.push(this.log(b.getInfo())));return d},d.prototype.syncAbonentsAndUserlist=function(b,c){var d,e,f,g,h,i,j=this;if(d={},0===(null!=b?b.length:void 0)||1===b.length&&(null!=(g=b[0])?g.isIvr:void 0)&&!(null!=(h=b[0])?h.phone:void 0))for(e in c)__hasProp.call(c,e)&&(f=c[e],delete c[e]);a.each(b,function(a,b){var e,f,g;if(b&&(e=(null!=(g=b.phone)&&"function"==typeof g.toString?g.toString():void 0)||b.ivrName||""))return d[e]=b,c[e.toString()]?void 0:(f=j.getUser({name:b.name,number:b.phone||"",id:b.userid,state:b.isIvr?5:1,isIvr:b.isIvr,ivrName:b.ivrName},b.isIvr&&!b.phone),c[e.toString()]=f)}),i=[];for(e in c)__hasProp.call(c,e)&&(f=c[e],i.push(d[f.number]?void 0:delete c[f.number]));return i},d.prototype.setAbonents=function(a){var b,c,d,e,f=this;this.log("setAbonents",a,this.abonents),d=this.abonents;for(c in d)__hasProp.call(d,c)&&(b=d[c],b.removeAction("dtmf"));if(this.syncAbonentsAndUserlist(a,this.abonents),this.log("setAbonents synced",this.abonents),!this.oktell.conferenceId){e=this.abonents;for(c in e)__hasProp.call(e,c)&&(b=e[c],b.addAction("dtmf",function(){return f.toggleDtmf()}))}return this.setAbonentsHtml(),setTimeout(function(){return f.setUserListHeight()},200)},d.prototype.setQueue=function(a){var b,c,d,e,f,g;if("ring"===this.oktell.getState())for(c=e=0,f=a.length;f>e;c=++e)b=a[c],this.abonents[b.phone]&&delete a[c];this.syncAbonentsAndUserlist(a,this.queue),g=this.queue;for(c in g)__hasProp.call(g,c)&&(d=g[c],d.loadActions());return this.setQueueHtml()},d.prototype.setHold=function(a){var b;return b=[],a.hasHold&&(b=a.conferenceid?[{number:a.conferenceRoom,id:a.conferenceid,name:a.conferenceName}]:[a.abonent]),this.syncAbonentsAndUserlist(b,this.hold),this.setHoldHtml()},d.prototype.setPanelUsersHtml=function(a){return this._setUsersHtml(a,this.usersListEl),this.userScrollerToTop()},d.prototype.setAbonentsHtml=function(){return this._setActivityPanelUserHtml(this.abonents,this.abonentsListEl,this.abonentsListBlock)},d.prototype.setHoldHtml=function(){return this._setActivityPanelUserHtml(this.hold,this.holdListEl,this.holdBlockEl)},d.prototype.setQueueHtml=function(){return this._setActivityPanelUserHtml(this.queue,this.queueListEl,this.queueBlockEl)},d.prototype._setActivityPanelUserHtml=function(a,b,c){var d,e,f,g=this;f=[];for(d in a)__hasProp.call(a,d)&&(e=a[d],f.push(e));return this._setUsersHtml(f,b,!0),f.length&&c.is(":not(:visible)")?(c.stop(!0,!0),this.resetStickyHeaders(),c.slideDown(50,function(){return g.setUserListHeight(),g.initStickyHeaders()})):0===f.length&&c.is(":visible")?(c.stop(!0,!0),this.resetStickyHeaders(),c.slideUp(50,function(){return g.setUserListHeight(),g.initStickyHeaders()})):void 0},d.prototype._setUsersHtml=function(a,b,c){var d,e,f,g,h,i,j;for(d=[],e=null,f="",i=0,j=a.length;j>i;i++)g=a[i],h=g.getEl(c),null!=(null!=h?h[0]:void 0)&&d.push(h[0]),g.showLetter(f!==g.letter?!0:!1),f=g.letter;return b.children().detach(),b.html(d)},d.prototype.setFilter=function(b,c,d){var e,f,g,h,i,j,k,l,m,n=this;if(this.filter===b&&!c)return!1;if(i=this.filter,this.filter=b,this.filterLang=b.match(/^[^А-яёЁ]+$/)?"en":b.match(/^[^A-z]+$/)?"ru":"",h=!1,this.timer(),this.panelUsersFiltered=[],e=[],j=function(a){var c,d,f,g;return d=a.getEl(""!==b),null!=(null!=d?d[0]:void 0)?(d=d[0],c=!1,g=a.getUsers(b,n.showOffline,n.filterLang),f=g[0],c=g[1],n.panelUsersFiltered=n.panelUsersFiltered.concat(f),0!==f.length?(h||(h=c),n._setUsersHtml(f,a.getContainer()),c&&h===c?e.unshift(d):e.push(d)):void 0):void 0},this.showDeps)for(m=this.departments,k=0,l=m.length;l>k;k++)f=m[k],j(f);else j(this.allUserDep);return!h&&b.match(/[0-9\(\)\+\-]/)?(this.filterFantomUser=this.getUser({name:b,number:b},!0),this.exactMatchUserDep.clearUsers(),this.exactMatchUserDep.addUser(this.filterFantomUser),g=this.exactMatchUserDep.getEl(),this._setUsersHtml([this.filterFantomUser],this.exactMatchUserDep.getContainer()),this.filterFantomUser.showLetter(!1),null!=(null!=g?g[0]:void 0)&&e.unshift(g[0])):this.filterFantomUser=!1,this.scrollContent.children().detach(),this.scrollContent.html(e),e.length>0&&a(e[e.length-1]).find("tr:last").addClass("g_last"),this.initStickyHeaders(),d||this.userScrollerToTop(),setTimeout(function(){return n.setUserListHeight()},1),this.timer(!0)},d.prototype.getUser=function(a,c){var d,e,f,g;return this.log("getUser dontRemember="+c,a),"string"==typeof a||"number"==typeof a?(f=a.toString(),a={number:f}):f=a.number.toString(),this.log("getUser strNumber="+f),e=a.phoneFormatted||("function"==typeof I.formatPhone?I.formatPhone(f):void 0)||f,a.numberFormatted||(a.numberFormatted=e),a.isIvr||c||(null!=(g=this.filterFantomUser)?g.number:void 0)!==f||(this.usersByNumber[f]=this.filterFantomUser,a.isFantom=!0,this.filterFantomUser=!1),a.isIvr&&!a.number||!this.usersByNumber[f]?(d=new b({number:f,numberFormatted:e,name:a.name,isFantom:!0,state:null!=(null!=a?a.state:void 0)?a.state:1,isIvr:null!=a?a.isIvr:void 0,ivrName:null!=a?a.ivrName:void 0}),c||(this.usersByNumber[f]=d),d):(this.usersByNumber[f].isFantom&&this.usersByNumber[f].init(a),this.usersByNumber[f])},d.prototype.reloadActions=function(){var a=this;return setTimeout(function(){var b,c,d,e,f,g,h,i;e=a.userWithGeneratedButtons;for(c in e)__hasProp.call(e,c)&&(d=e[c],b=d.loadActions());f=a.abonents;for(c in f)d=f[c],d.loadActions();g=a.queue;for(c in g)d=g[c],d.loadActions();h=a.panelUsersFiltered,i=[];for(c in h)d=h[c],i.push(d.loadActions());return i},100)},d.prototype.timer=function(a){return a&&this._time,a?void 0:this._time=Date.now()},d.prototype.beforeUserAction=function(a){return this.filterFantomUser&&a===this.filterFantomUser?this.clearFilter():void 0},d.prototype.config=function(a){var b,c,d,e;if(!this._config){if(("undefined"!=typeof localStorage&&null!==localStorage?localStorage.oktellPanel:void 0)&&("undefined"!=typeof JSON&&null!==JSON?JSON.parse:void 0)){try{this._config=JSON.parse(localStorage.oktellPanel)}catch(f){b=f}(null==this._config||"object"!=typeof this._config)&&(this._config={})}else this._config={};e=this.defaultConfig;for(c in e)__hasProp.call(e,c)&&(d=e[c],null==this._config[c]&&(this._config[c]=d))}if(null!=a){for(c in a)__hasProp.call(a,c)&&(d=a[c],this._config[c]=d);localStorage&&("undefined"!=typeof JSON&&null!==JSON?JSON.stringify:void 0)&&localStorage.setItem("oktellPanel",JSON.stringify(this._config))}return this.showDeps=this._config.showDeps,this.showOffline=this._config.showOffline,this.buttonShowOffline.toggleClass("g_active",!this.showOffline),this.buttonShowOffline.attr("title",this.showOffline?this.langs.panel.showOnlineOnly:this.langs.panel.showOnlineOnlyCLicked),this.buttonShowDeps.toggleClass("g_active",this.showDeps),this.buttonShowDeps.attr("title",this.showDeps?this.langs.panel.showDepartmentsClicked:this.langs.panel.showDepartments),this._config},d}(),h=function(){function b(a,b,c){var d,e=this;this.el=a,this._lastPopupShowTime=0,this.ringtone=c,this.absContainer=this.el.find(".b_content"),this.abonentEl=this.absContainer.find(".b_abonent").remove(),this.answerActive=!1,this.answerButttonEl=this.el.find(".j_answer"),this.puckupEl=this.el.find(".j_pickup"),this.el.find(".j_abort_action").bind("click",function(){return e.hide(),e.playRingtone(!1),b.endCall()}),this.el.find(".j_answer").bind("click",function(){return e.hide(),e.playRingtone(!1),b.answer()}),this.el.find(".j_close_action").bind("click",function(){return e.hide()}),this.el.find("i.o_close").bind("click",function(){return e.hide()}),d=!1,b.on("connect",function(){return e.users=b.getUsers()}),b.on("webrtcRingStart",function(a,b){var c;return e.log("webrtcRingStart, "+b),e.playRingtone(!0),e.answerButtonVisible(!0),d||e.setAbonents([{name:a,phone:(null!=(c=b.match(/<sip:([\s\S]+?)@/))?c[1]:void 0)||""}]),e.show()}),b.on("ringStart backRingStart",function(a){return e.log("ringStart",a),e.setAbonents(a),setTimeout(function(){var c,d;return(null!=a&&null!=(c=a[0])?c.phone:void 0)&&-1!==(null!=(d=b.getPhoneActions(a[0].phone))&&"function"==typeof d.indexOf?d.indexOf("answer"):void 0)?e.answerButtonVisible(!0):void 0},10),d=!0,e.show()}),b.on("ringStop",function(){return e.hide()}),b.on("stateChange",function(a,b){return"call"===a&&"backring"===b||"ready"===a||"talk"===a?e.hide():void 0}),this.answerButtonVisible(!1)}return b.prototype.logGroup="Popup",b.prototype.playRingtone=function(a){var b;try{if(this.ringtone)return a?(this.ringtone.currentTime=0,this.ringtone.play()):this.ringtone.pause()}catch(c){return b=c,this.log("playRingtone "+a+" throw error",b)}},b.prototype.show=function(a){return Date.now()-this._lastPopupShowTime<1e3?void 0:(this._lastPopupShowTime=Date.now(),this.log("Popup show! ",a),this.el.fadeIn(200))},b.prototype.hide=function(){var a=this;return this.log("Popup hide!"),this.playRingtone(!1),this.el.fadeOut(200,function(){var b;return a.setAbonents([]),b=!1})},b.prototype.setAbonents=function(b){var c=this;return this.absContainer.empty(),a.each(b,function(a,b){var d,e,f,g,h,i,j,k,l,m;if(!b)return void c.log("setAbonent: bad abonent");if(h=null!=(k=b.phoneFormatted)&&"function"==typeof k.toString?k.toString():void 0,g=null!=(l=b.phone)&&"function"==typeof l.toString?l.toString():void 0,f=null!=(m=b.name)&&"function"==typeof m.toString?m.toString():void 0,f===g){e=!1;for(i in c.users)if(j=c.users[i],j.number===g){f=j.name,e=!0;break}c.log("Found "+g+" in users = "+e),e||(f=h||g,g="")}else f=b.name.toString();return d=c.abonentEl.clone(),d.find("span:first").text(f),d.find("span:last").text(g),c.absContainer.append(d)})},b.prototype.answerButtonVisible=function(a){return a?(this.answerActive=!0,this.answerButttonEl.show(),this.puckupEl.hide()):(this.answerActive=!1,this.answerButttonEl.hide(),this.puckupEl.show()),this.answerActive},b.prototype.setCallbacks=function(a,b){return this.onAnswer=a,this.onTerminate=b},b}(),g=function(){function a(a,b){var c=this;this.el=a,b&&(b.on("mediaPermissionsRequest",function(){return c.show()}),b.on("mediaPermissionsAccept",function(){return c.hide()}),b.on("mediaPermissionsRefuse",function(){return"undefined"!=typeof I&&null!==I&&I.endCall(),c.hide()}))}return a.prototype.show=function(){return this.log("Permissions Popup show!"),this.el.show()},a.prototype.hide=function(){return this.el.fadeOut(200)},a}(),d=function(){function a(a,b){var c=this;this.el=a,b.on("connecting",function(){return c.hide()}),b.on("disconnect",function(a){return c.log("disconnect with reason "+a.code+" "+a.message),12===a.code?c.show(3,b.getMyInfo().login):void 0}),b.on("connectError",function(a){switch(c.log("connect error "+a.errorCode+" "+a.errorMessage),a.errorCode){case 12:return c.show(1,b.getMyInfo().login);case 13:return c.show(2,b.getMyInfo().login);case 1204:return c.show(1,b.getMyInfo().login);case 1202:return c.show(2,b.getMyInfo().login);default:return c.show(3,b.getMyInfo().login)}})}return a.prototype.logGroup="Error",a.prototype.errorTypes={1:"usingOktellClient",2:"loginPass",3:"unavailable"},a.prototype.onShow=function(){},a.prototype.show=function(a,b){var c,d,e;return this.errorTypes[a]?(this.log("show "+a),c=this.errorTypes[a],this.el.find("p:eq(0)").text(this.langs[c].header.replace("%username%",b)),this.el.find("p:eq(1)").text((null!=(d=this.langs[c].message)?d.replace("%username%",b):void 0)||""),this.el.find("p:eq(3)").text((null!=(e=this.langs[c].message2)?e.replace("%username%",b):void 0)||""),"function"==typeof this.onShow&&this.onShow(),this.el.fadeIn(200)):!1},a.prototype.hide=function(){return this.el.fadeOut(200)},a}(),s={position:"right",dynamic:!1,oktell:window.oktell,oktellVoice:window.oktellVoice,ringtone:"ringtone.mp3",debug:!1,lang:"ru",showAvatar:!1,hideOnDisconnect:!0,useNotifies:!1,withoutPermissionsPopup:!1,withoutCallPopup:!1,withoutError:!1},C={ru:{panel:{dtmf:"донабор",dtmfPanelName:"Донабор",inTalk:"В разговоре",onHold:"На удержании",queue:"Очередь ожидания",inputPlaceholder:"введите имя или номер",withoutDepartment:"без отдела",showDepartments:"Группировать по отделам",showDepartmentsClicked:"Показать общим списком",showOnlineOnly:"Показать только online",showOnlineOnlyCLicked:"Показать всех"},actions:{answer:"Ответить",call:"Позвонить",conference:"Конференция",transfer:"Перевести",toggle:"Переключиться",intercom:"Интерком",endCall:"Завершить",ghostListen:"Прослушка",ghostHelp:"Помощь",hold:"Удержание",resume:"Продолжить",dtmf:"Донабор"},callPopup:{title:"Входящий вызов",hide:"Скрыть",answer:"Ответить",reject:"Отклонить",undefinedNumber:"Номер не определен",goPickup:"Поднимите трубку",answer:"Ответить"},permissionsPopup:{header:"Запрос на доступ к микрофону",text:"Для использования веб-телефона необходимо разрешить браузеру доступ к микрофону."},error:{title:"Ошибка",usingOktellClient:{header:"Пользователь «%username%» использует стандартный Oktell-клиент.",message:"Одновременная работа двух типов клиентских приложений невозможна.",message2:"Закройте стандартный Oktell-клиент и повторите попытку."},loginPass:{header:"Пароль для пользователя «%username%» не подходит.",message:"Проверьте правильность имени пользователя и пароля."},unavailable:{header:"Сервер телефонии Oktell не доступен.",message:"Убедитесь что сервер телефонии работает и проверьте настройки соединения."}}},en:{panel:{dtmf:"dtmf",dtmfPanelName:"DTMF",inTalk:"In conversation",onHold:"On hold",queue:"Wait queue",inputPlaceholder:"Enter name or number",withoutDepartment:"Without department",showDepartments:"Show departments",showDepartmentsClicked:"Hide departments",showOnlineOnly:"Show online only",showOnlineOnlyCLicked:"Show all"},actions:{answer:"Answer",call:"Dial",conference:"Conference",transfer:"Transfer",toggle:"Switch",intercom:"Intercom",endCall:"End",ghostListen:"Audition",ghostHelp:"Help",hold:"Hold",resume:"Resume",dtmf:"DTMF"},callPopup:{title:"Incoming call",hide:"Hide",answer:"Answer",reject:"Decline",undefinedNumber:"Phone number is not defined",goPickup:"Pick up the phone",answer:"Answer"},permissionsPopup:{header:"Request for access to the microphone",text:"To use the web-phone you need to allow browser access to the microphone."},error:{title:"Error",usingOktellClient:{header:"User «%username%» uses standard Oktell client application.",message:"Simultaneous work of two types of client applications is not possible.",message2:"Close standard Oktell client application and try again."},loginPass:{header:"Wrong password for user «%username%».",message:"Make sure that the username and password are correct."},unavailable:{header:"Oktell server is not available.",message:"Make sure that Oktell server is running and check your connection."}}},cz:{panel:{dtmf:"dtmf",dtmfPanelName:"DTMF",inTalk:"V rozhovoru",onHold:"Na hold",queue:"Fronta čekaní",inputPlaceholder:"zadejte jméno nebo číslo",withoutDepartment:"Bez oddělení",showDepartments:"Zobrazit oddělení",showDepartmentsClicked:"Skrýt oddělení",showOnlineOnly:"Zobrazit pouze online",showOnlineOnlyCLicked:"Zobrazit všechny"},actions:{answer:"Odpověď",call:"Zavolat",conference:"Konference",transfer:"Převést",toggle:"Přepnout",intercom:"Intercom",endCall:"Ukončit",ghostListen:"Odposlech",ghostHelp:"Nápověda",hold:"Udržet",resume:"Pokračovat",dtmf:"DTMF"},callPopup:{title:"Příchozí hovor",hide:"Schovat",answer:"Odpovědět",reject:"Odmítnout",undefinedNumber:"",goPickup:"Zvedněte sluchátko",answer:"Odpovědět"},permissionsPopup:{header:"Žádost o přístup k mikrofonu",text:"Abyste mohli používat telefon, musíte povolit prohlížeče přístup k mikrofonu."},error:{title:"Chyba",usingOktellClient:{header:"Uživatel «%username%» používá standardní Oktell klientské aplikace.",message:"Současnou práci dvou typů klientských aplikací není možné.",message2:"Zavřít Oktell standardní klientskou aplikaci a zkuste to znovu."},loginPass:{header:"Chybné heslo uživatele «%username%».",message:"Ujistěte se, že uživatelské jméno a heslo jsou správné."},unavailable:{header:"Oktell server není k dispozici.",message:"Ujistěte se, že Oktell server běží a zkontrolujte připojení."}}}},K=null,k=null,I=null,J=!1,n=null,D=null,Q=null,O=null,u=null,L=null,p=null,i="oktellPanelActionButton",x=function(){return K||s},B=navigator.userAgent.match(/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i)?!0:!1,U=!B,T=B,o=function(){var a,b,c,d,e,f,g;for(a=document.createElement("div"),b=a.style,c="Transform",d=["o"+c,"ms"+c,"webkit"+c,"Webkit"+c,"Moz"+c,"transform"],f=0,g=d.length;g>f;f++)if(e=d[f],null!=b[e])return!0;return b},G="",F=function(){var a,b,c,d,e,f,g,h,i,j;if(a=1<=arguments.length?__slice.call(arguments,0):[],x().debug){for(b=new Date,c=b.getFullYear()+"-"+(b.getMonth()<10?"0":"")+b.getMonth()+"-"+(b.getDate()<10?"0":"")+b.getDate(),g=(b.getHours()<10?"0":"")+b.getHours()+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()+":"+(b.getSeconds()<10?"0":"")+b.getSeconds()+":"+(b.getMilliseconds()+1e3).toString().substr(1),G+=c+" "+g+" | ",e="log","error"===a[0].toString().toLowerCase()&&(e="error"),f=i=0,j=a.length;j>i;f=++i){if(h=a[f],"object"==typeof h)try{G+=JSON.stringify(h)}catch(k){d=k,G+=h.toString()}else G+=h;G+=" | "}G+="\n\n",a.unshift("Oktell-Panel.js "+g+" |"+("string"==typeof this.logGroup?" "+this.logGroup+" |":""));try{return console[e].apply(console,a||[])}catch(k){d=k}}},S={"templates/actionButton.html":'<ul class="oktell_button_action"><li class="g_first"><i></i></li><li class="g_last drop_down"><i></i></li></ul>',"templates/actionList.html":'<ul class="oktell_actions_group_list"><li class="{{css}}" data-action="{{action}}"><i></i> <span>{{actionText}}</span></li></ul>',"templates/user.html":'<tr class="b_contact"><td class="b_capital_letter"><span></span></td><td class="b_contact_avatar {{css}}"><img src="{{avatarLink32x32}}"> <i></i><div class="o_busy"></div></td><td class="b_contact_title"><div class="wrapword" title="{{name}}"><span class="b_contact_name"><b>{{name1}}</b><span>{{name2}}</span></span><span class="o_number">{{number}}</span><span class="o_dtmf">{{dtmf}}</span></div></td><td class="b_contact_status"><div class="o_dot_status"></div>{{button}}</td></tr>',"templates/department.html":'<tr class="b_contact"><td class="b_contact_department" colspan="3">{{department}}</td></tr>',"templates/dep.html":'<div class="b_department"><div class="b_department_header"><div class="h_shadow_top"><span>{{department}}</span></div></div><table class="b_main_list"><tbody></tbody></table></div>',"templates/usersTable.html":'<table class="b_main_list m_without_department"><tbody></tbody></table>',"templates/panel.html":'<div class="oktell_panel"><div class="i_panel_bookmark"><div class="i_panel_bookmark_bg"></div></div><div class="h_panel_bg"><div class="b_header"><ul class="b_list_filter"><li class="i_group"></li><li class="i_online"></li></ul></div><div class="h_padding"><div class="b_marks i_conference j_abonents"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{inTalk}}</span> <span class="b_marks_time"></span></p><table><tbody></tbody></table></div></div></div><div class="b_marks i_extension" style="display: none"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{dtmfPanelName}}</span></p><div class="h_btn-group"><div class="btn-group"><button class="btn btn-small">1</button> <button class="btn btn-small">2</button> <button class="btn btn-small">3</button> <button class="btn btn-small">4</button> <button class="btn btn-small">5</button> <button class="btn btn-small">6</button> <button class="btn btn-small">7</button> <button class="btn btn-small">8</button> <button class="btn btn-small">9</button> <button class="btn btn-small">0</button></div><div class="btn-group"><button class="btn btn-small">&lowast;</button> <button class="btn btn-small">#</button></div></div></div></div><i class="o_close"></i></div><div class="b_marks i_flash j_hold"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{onHold}}</span></p><table class="j_table_favorite"><tbody></tbody></table></div></div></div><div class="b_marks i_flash j_queue"><div class="h_shadow_top"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{queue}}</span></p><table class="j_table_queue"><tbody></tbody></table></div></div></div><div class="b_inconversation j_phone_block"><table class="j_table_phone"><tbody></tbody></table></div><div class="b_marks i_phone"><div class="h_shadow_top"><div class="h_phone_number_input"><div class="i_phone_state_bg"></div><div class="h_input_padding"><div class="jInputClear_hover"><input class="b_phone_number_input" type="text" placeholder="{{inputPlaceholder}}"><span class="jInputClear_close">&times;</span></div></div></div></div></div><div class="b_sticky_header_container"></div><div class="h_main_list j_main_list"></div></div></div></div>',"templates/callPopup.html":'<div class="oktell_panel_popup" style="display: none"><div class="m_popup_staff"><div class="m_popup_data"><header><div class="h_header_bg"><i class="o_close"></i><h2>{{title}}</h2></div></header><div class="b_content"><div class="b_abonent"><span data-bind="text: name"></span>&nbsp; <span class="g_light" data-bind="textPhone: number"></span></div></div><div class="footer"><button class="oktell_panel_btn btn--success btn--large btn--take_phone j_pickup"><i></i>{{goPickup}}</button>  <button class="oktell_panel_btn btn--large btn--success btn--take_phone j_answer"><i></i>{{answer}}</button> <button class="oktell_panel_btn btn--large j_close_action">{{hide}}</button> <button class="oktell_panel_btn btn--large btn--danger j_abort_action"><i></i>{{reject}}</button></div></div></div></div>',"templates/permissionsPopup.html":'<div class="oktell_panel_popup" style="display: none"><div class="m_popup_staff"><div class="m_popup_data"><header><div class="h_header_bg"><h2>{{header}}</h2></div></header><div class="b_content"><p>{{text}}</p></div></div></div></div>',"templates/error.html":'<div class="b_error m_form" style="display: none"><div class="h_padding"><h4>{{title}}</h4><p class="b_error_alert"></p><p class="g_light"></p><p class="g_light"></p></div></div>'},E=function(b){var c;return"/"===b[0]&&(b=b.substr(1)),null!=S[b]?S[b]:(c="",a.ajax({url:b,async:!1,success:function(a){return c=a}}),c)},j=E("/templates/actionButton.html"),l=E("/templates/actionList.html"),V=E("/templates/user.html"),t=E("/templates/department.html"),t=E("/templates/dep.html"),W=E("/templates/usersTable.html"),M=E("/templates/panel.html"),R=E("/templates/callPopup.html"),P=E("/templates/permissionsPopup.html"),v=E("/templates/error.html"),e.prototype.usersTableTemplate=W,b.prototype.buttonTemplate=j,b.prototype.log=F,e.prototype.log=F,h.prototype.log=F,g.prototype.log=F,c.prototype.log=F,d.prototype.log=F,c.prototype.template=t,N=!1,A=function(f){var i,m,q,r,w,y,z,A,B,E,F,G,H,J,S,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb;
return N=!0,K=a.extend({},s,f||{}),gb=!1,y=(null!=(jb=x().container)?jb[0]:void 0)||x().container,p=null,y&&"object"==typeof HTMLElement&&y instanceof HTMLElement||1===(null!=y?y.nodeType:void 0)&&"string"==typeof y.nodeName?(p=a(y),gb=!0):p=a("body"),gb&&(U=!1,T=!0),K.oktellVoice&&(K.oktellVoice.isOktellVoice===!0?K.oktellVoice=K.oktellVoice:window.oktellVoice(window.oktellVoice.isOktellVoice===!0)&&(K.oktellVoice=window.oktellVoice)),x().useNotifies&&window.webkitNotifications&&1===window.webkitNotifications.checkPermission()&&webkitNotifications.requestPermission(function(){}),c.prototype.withoutDepName=e.prototype.withoutDepName=b.prototype.withoutDepName="zzzzz_without",C=C[K.lang]||C.ru,b.prototype.template=V.replace("{{button}}",j),M=M.replace("{{inTalk}}",C.panel.inTalk).replace("{{dtmfPanelName}}",C.panel.dtmfPanelName).replace("{{onHold}}",C.panel.onHold).replace("{{queue}}",C.panel.queue).replace("{{inputPlaceholder}}",C.panel.inputPlaceholder),e.prototype.langs=C,e.prototype.departmentTemplate=t,d.prototype.langs=C.error,b.prototype.langs=C,c.prototype.langs=C,L=a(M),x().showAvatar||L.addClass("noavatar"),k=a(l),a("body").append(k),I=x().oktell,b.prototype.formatPhone=I.formatPhone,cb=null,x().ringtone&&(cb=a('<audio src="'+x().ringtone+'" id="oktell_panel_ringtone" preload="auto"></audio>')[0],a("body").append(cb),cb.loop=!0),x().withoutCallPopup||(R=R.replace("{{title}}",C.callPopup.title).replace("{{goPickup}}",C.callPopup.goPickup).replace("{{answer}}",C.callPopup.answer).replace("{{hide}}",C.callPopup.hide).replace("{{reject}}",C.callPopup.reject),bb=a(R),a("body").append(bb),Q=new h(bb,I,cb)),x().withoutPermissionsPopup||(P=P.replace("{{header}}",C.permissionsPopup.header).replace("{{text}}",C.permissionsPopup.text),ab=a(P),a("body").append(ab),O=new g(ab,x().oktellVoice)),x().withoutError||(v=v.replace("{{title}}",C.error.title),B=a(v),L.find(".h_panel_bg:first").append(B),u=new d(B,I)),$=x().position,m={},m[$]="0px",i={},i[$]="-281px",Z=-281,L.hide(),gb&&L.addClass("contained"),p.append(L),D=new e(I,L,k,n,x(),gb,U,T,x().debug),x().debug&&(window.wList=D,window.wPopup=Q,window.wError=u),"right"===$?L.addClass("right"):"left"===$&&L.addClass("left"),x().dynamic&&L.addClass("dynamic"),gb||(X=L.find(".i_panel_bookmark"),r={},w="left"===$?"right":"left",r[w]="0px",q={},q[w]="-40px",S=!1,Y=!1,ib="closed",_=function(a){return a&&a!==ib&&(ib=a),ib},G=function(){return clearTimeout(Y),Y=!1},hb=o(),eb=null,F=null,z=!1,db=function(){return D.beforeShow(),_("opening"),X.css(r),hb?z?void 0:(z=!0,L.css("right",""),clearTimeout(eb),L.removeClass("hide_t_"+$).addClass("show_t_"+$),eb=setTimeout(function(){return L.css("right","0px"),L.removeClass("show_t_"+$),D.afterShow(),L.addClass("g_hover"),_("open"),X.css(r),z=!1},200)):(L.stop(!0,!0),L.animate(m,100,"swing",function(){return D.afterShow(),L.addClass("g_hover"),_("open"),X.css(r)}))},E=function(){return hb?z?void 0:(_("closing"),D.beforeHide(),z=!0,L.css("right",""),clearTimeout(F),L.removeClass("show_t_"+$).addClass("hide_t_"+$),F=setTimeout(function(){return L.css("right","-281px"),L.removeClass("hide_t_"+$),D.afterHide(),L.removeClass("g_hover"),X.css(q),_("closed"),z=!1},400)):(_("closing"),D.beforeHide(),L.stop(!0,!0),L.animate(i,300,"swing",function(){return L.css({panelPos:0}),D.afterHide(),L.removeClass("g_hover"),X.css(q),_("closed")}))},L.bind("mouseenter",function(){return S=!0,G(),parseInt(L.css($))<0&&("closed"===_()||"closing"===_())&&db(),!0}),W=!1,J=-250,H=30,fb=!1,A=!1,X.bind("touchstart",function(){return"closed"===_()?_("touchopening"):"open"===_()&&_("touchclosing"),!0}),X.bind("touchmove",function(a){var b,c,d,e;return("touchopening"===_()||"touchclosing"===_())&&(fb=!0),A&&fb&&(c=null!=a&&null!=(d=a.originalEvent)&&null!=(e=d.touches)?e[0]:void 0,c&&(W!==!1&&(b=parseInt(L.css($)),L.css($,Math.max(Z,Math.min(0,b+W-c.pageX))+"px")),W=c.pageX)),!0}),X.bind("touchend",function(){var a;return fb?(fb=!1,a=parseInt(L.css($)),"touchopening"===_()?a>J?db():E():"touchclosing"===_()&&(H>a?E():openPanel())):"touchopening"===_()&&db(),!0}),X.bind("touchcancel",function(){return!0}),a(window).bind("touchcancel",function(){return!0}),a(window).bind("touchend",function(b){var c,d,e;return e=a(b.target),c=e.parents(),d=c.toArray(),-1===d.indexOf(L[0])&&E(),!0}),L.bind("mouseleave",function(){return S=!1,!0}),a("html").bind("mouseleave",function(){return G(),!0}),a("html").bind("mousemove",function(){return"open"!==_()||S||Y!==!1||D.dropdownOpenedOnPanel||(Y=setTimeout(function(){return E()},100)),!0})),a(".oktell_actions_group_list").on("touchstart",function(a){return a.stopPropagation(),!0}),a("body").on("touchstart",function(){return null!=D&&"function"==typeof D.hideActionListDropdown?D.hideActionListDropdown():void 0})},n=function(){return J=!0},z=function(a){var b,c;return a.addClass(x().buttonCss),c=a.attr("data-phone"),a.empty(),c?(b=D.getUserButtonForPlugin(c.replace(/\+/g,"")),a.html(b)):void 0},m=function(a){return z(a)},y=function(b){return a(b+":not(."+i+")").each(function(){return m(a(this))})},a.oktellPanel=function(a){if("string"==typeof a){if(N)return y(a)}else if(!N)return A(a)},a.fn.oktellButton=function(){return a(this).each(function(){return m(a(this))})},a.fn.oktellPanel=function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],N?a(this)[0]===(null!=L?L[0]:void 0)?a.oktellPanel.apply(window,b):void 0:(b.container=a(this),a.oktellPanel.apply(window,b))},a.oktellPanel.show=function(){return D.showPanel()},a.oktellPanel.hide=function(){return D.hidePanel()}}($);