var __indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},__bind=function(t,e){return function(){return t.apply(e,arguments)}};(function(t){var e,n,i,s,o,r,a,l,u,c,d,h,p,f,b,m,g,v,_,y,w,k,E,x,L,A,C,H;if(!t)throw Error("Error init oktell panel, jQuery ( $ ) is not defined");return C={"templates/actionButton.html":'<ul class="b_button_action"><li class="g_first"><i></i></li><li class="g_last drop_down"><i></i></li></ul>',"templates/actionList.html":'<ul style="display: none; z-index: 999; padding: 0; font-size: 13px; font-family: Tahoma" class="b_actions_group_list" data-bind="foreach: { data: items, as: \'a\' }"><li class="{{css}}" data-bind="click: $parent.doActionByClick, css: $data.css, hoverSelect: true" data-action="{{action}}"><i></i><span data-bind="text: a.text">{{actionText}}</span></li></ul>',"templates/user.html":'<tr class="b_contact" data-bind1="hoverSelect: true, actionBar: $data, css: { \'m_offline\': $data.isOffline, \'m_busy\': $data.isBusy }"><td class="b_contact_avatar {{css}}"><img data-bind="attr: { src: $data.avatarLink32x32 }" src="{{avatarLink32x32}}"><i></i><div class="o_busy"></div></td><td class="b_contact_title"><div class="wrapword"><a><b data-bind="text: $data.name">{{name}}</b><span class="o_number" data-bind="text: $data.showedNumber">{{number}}</span></a></div></td></tr>',"templates/panel.html":'<div class="l_panel j_panel"><div class="i_panel_bookmark"><div class="i_panel_bookmark_bg"></div></div><div class="h_panel_bg"><div class="h_padding" style="height: 100%"><div class="b_marks i_conference j_abonents" style="display: none"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{inTalk}}</span><span class="b_marks_time"></span></p><table><tbody></tbody></table></div></div><div class="b_marks i_flash j_hold" style="display: none"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{onHold}}</span></p><table class="j_table_favorite"><tbody></tbody></table></div></div><div class="b_marks i_flash j_queue" style="display: none"><div class="b_marks_noise"><p class="b_marks_header"><span class="b_marks_label">{{queue}}</span></p><table class="j_table_queue"><tbody></tbody></table></div></div><div class="b_inconversation j_phone_block"><table class="j_table_phone" style="width: 100%"><tbody></tbody></table></div><div class="b_marks i_phone"><div class="h_shadow_bottom"><div class="h_phone_number_input"><div class="i_phone_state_bg"></div><div class="h_input_padding"><div class="i_phone_popup_button j_keypad_expand"><i></i></div><div class="jInputClear_hover"><input class="b_phone_number_input" type="text" placeholder="{{inputPlaceholder}}"><span class="jInputClear_close">&times;</span></div></div><div class="b_phone_keypad j_phone_keypad" style="display: none"><div class="l_column_group"><div class="h_phone_keypad"><ul class="b_phone_panel"><li class="g_top_left g_first"><button data-num="1" class="g_button m_big">1</button></li><li><button data-num="2" class="g_button m_big">2</button></li><li class="g_top_right g_right"><button data-num="3" class="g_button m_big">3</button></li><li class="g_float_celar g_first"><button data-num="4" class="g_button m_big">4</button></li><li><button data-num="5" class="g_button m_big">5</button></li><li class="g_right"><button data-num="6" class="g_button m_big">6</button></li><li class="g_float_celar g_first"><button data-num="7" class="g_button m_big">7</button></li><li><button data-num="8" class="g_button m_big">8</button></li><li class="g_right"><button data-num="9" class="g_button m_big">9</button></li><li class="g_bottom_left g_float_celar g_first"><button data-num="*" class="g_button m_big">&lowast;</button></li><li class="g_bottom_center"><button data-num="0" class="g_button m_big">0</button></li><li class="g_bottom_right g_right"><button data-num="#" class="g_button m_big">#</button></li></ul></div></div></div></div></div></div><div class="j_main_list" style="height: 100%; overflow: hidden"><table class="b_main_list"><tbody></tbody></table></div></div></div></div>'},y=function(){var t;try{return console.log.apply(console,arguments)}catch(e){t=e}},l=function(t,e,n){var i;return i="",function(){var s,o,r,a,l;return r=this,s=arguments,a=function(){var e;return i=null,n?void 0:e=t.apply(r,s)},o=n&&!i,clearTimeout(i),i=setTimeout(a,e),o&&(l=t.apply(r,s)),l}},d=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},m=function(e){var n,i,s,o,r,a,l,u,c,d,h,p,f,b,m,g,v,_,y,w,k,E,x,L,A,C,H,B,U,j;return j="",L="",E="",x="",A="",h="",p="",f="",m="",g="",C="",b={},y=function(t,e,n){var i;return t=t.originalEvent,i=t.detail?-14*t.detail:t.wheelDelta/3,g=l(n),p=a(t),(g>=0&&i>0||g+i>0)&&(i=0,g=0),(e.height()-n.height()>=g&&0>i||e.height()-n.height()>g+i)&&(g=e.height()-n.height(),i=0),m=g+i},v=function(e,o,u,d,v){var y,E;if(e.type===s){if(b.noMoveMouse)return;return f=a(e),g=l(u),C=!0,t("body").css({"-moz-user-select":"none","-ms-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-webkit-touch-callout":"none","user-select":"none"})}if(e.type===i){if(!C)return;return c&&k(v),y=r(o,u),p=a(e),h?(m=g*y-(p-f),m/=y):m=g+(p-f),m>=0&&(g=l(u),f=p,m=0),E=o.height()-u.height(),E>=m&&(g=l(u),f=p,m=E),_(m,o,u,d,v),b.noMoveMouse=!0}if(e.type===n){if(!C)return;if(C=!1,h=!1,c&&w(v),t("body").css({"-moz-user-select":"","-ms-user-select":"","-khtml-user-select":"","-webkit-user-select":"","-webkit-touch-callout":"","user-select":""}),A)return w(v)}},_=function(t,e,n,i,s){return k(s),B(n,t),H(e,n,i,s)},a=function(t){return c?t.originalEvent.targetTouches[0].clientY:t.clientY},B=function(t,e){return t.css({position:"relative",top:e})},l=function(t){var e;return e=t.css("top"),"auto"===e&&(e=0),parseInt(e)},r=function(t,e){var n,i,s;return s=t.height(),i=e.height(),n=s/i},k=function(t){return t.stop(!0,!0),t.fadeIn(100)},w=function(t){return t.stop(!0,!0),t.fadeOut("slow")},H=function(t,e,n,i){var s,o,a,u,c,d,h,p;return s=n.height(),a=r(t,e),o=s*a,h=a>=1?"hidden":"visible",i.css({height:o,visibility:h}),d=l(e),p=t.height(),c=e.height(),0>=d&&p-c>=d&&(m=p-c,m=Math.min(m,0),B(e,m)),u=d/p,m=p*u,B(i,-1*m*a),null!=b?"function"==typeof b.onScroll?b.onScroll({wrapper:t,scroller:e,position:d,length:c}):void 0:void 0},C=!1,h=!1,U=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":__indexOf.call(window,"opera")>=0?"O":"",c=window.ontouchstart!==void 0,s=c?"touchstart":"mousedown",i=c?"touchmove":"mousemove",n=c?"touchend":"mouseup",o="Moz"===U?"DOMMouseScroll":"mousewheel",!c&&t(".jscroll_wrapper",e).size()||(u=function(){var n,i,s;return e.wrapInner('<div class="jscroll_wrapper" />'),j=t(".jscroll_wrapper",e),j.attr("id","jscroll_id"+Math.round(1e7*Math.random())),L=j.wrapInner('<div class="jscroll_scroller" />'),L=t(".jscroll_scroller",j),E=t('<div class="jscroll_scrollbar_cont"></div>').insertAfter(L),E.css({position:"absolute",right:"0px",width:"13px",top:"3px",bottom:"6px"}),x=t('<div class="jscroll_scrollbar_inner"></div>').appendTo(E),x.css({position:"relative",width:"100%",display:"none",opacity:"0.4",cursor:"pointer"}),i=t('<div class="jscroll_scrollbar_bar"></div>').appendTo(x),i.css({position:"relative",background:"black",width:"5px",margin:"0 auto","border-radius":"3px",height:"100%","-webkit-border-radius":"3px"}),j.css({position:"relative",height:"100%",overflow:"hidden"}),L.css({"min-height":"100%",overflow:"hidden"}),c?(L.after('<div class="jscroll_scroller_inner" />'),s=t(".jscroll_scroller_inner",j),s.appendTo("<div></div>"),null!=window.iScroll&&(n=new window.iScroll(j.attr("id"),{hScrollbar:!1,scrollbarClass:"jscroll_scroller_inner",checkDOMChanges:!0,bounceLock:!0,onScrollMove:function(){return b.onScroll(),!0},onScrollEnd:function(){return b.onScroll(),!0}})),!0):H(j,L,E,x)},u(),c)?void 0:(d=[],j.bind("resize",function(){var t;t=j.attr("id"),d[t]!==void 0&&clearTimeout(d[t]),d[t]=setTimeout(function(){return H(j,L,E,x),delete d[t]},100)}),c||j.hover(function(){A=!1,H(j,L,E,x),k(x)},function(){A=!0,C||w(x)}),x.bind(s,function(){return h=!0,b.noMoveMouse=!1,!0}),j.bind(s,function(t){return v(t,j,L,E,x),!0}),t(document).bind(i,function(t){return v(t,j,L,E,x),!0}),t(document).bind(n,function(t){return v(t,j,L,E,x),!0}),j.on(o,function(t){var e;return e=y(t,j,L,E,x),_(e,j,L,E,x),!1}))},e=function(){function e(e){this.doAction=__bind(this.doAction,this);var n,i;this.id=null!=(n=e.id)?(""+n).toLowerCase():void 0,this.number=(null!=(i=e.number)?""+i:void 0)||"",this.numberHtml=d(e.number),this.name=e.name,this.nameHtml=e.name?d(e.name):this.numberHtml,this.state=!1,this.avatarLink32x32=e.avatarLink32x32||this.defaultAvatar32||"",this.defaultAvatarCss=this.avatarLink32x32?"":"m_default",this.hasHover=!1,this.buttonLastAction="",this.firstLiCssPrefix="m_button_action_",this.els=t(),this.buttonEls=t(),this.init(e)}return e.prototype.init=function(t){var e,n,i;return this.id=null!=(e=t.id)?(""+e).toLowerCase():void 0,this.number=(null!=(n=t.number)?""+n:void 0)||"",this.numberHtml=d(t.number),this.name=t.name,this.nameHtml=t.name?d(t.name):this.numberHtml,this.avatarLink32x32=t.avatarLink32x32||this.defaultAvatar32||"",this.defaultAvatarCss=this.avatarLink32x32?"":"m_default",this.loadActions(),null!=(null!=(i=t.numberObj)?i.state:void 0)?this.setState(t.numberObj.state):null!=t.state?this.setState(t.state):this.setState(1)},e.prototype.regexps={name:/\{\{name\}\}/,number:/\{\{number\}\}/,avatarLink32x32:/\{\{avatarLink32x32\}\}/,css:/\{\{css\}\}/},e.prototype.setState=function(t){var e=this;return t=parseInt(t),t!==this.state?(this.state=t,this.buttonEls.length?(y("LOAD actions after state change "),this.loadActions(),setTimeout(function(){return e.loadActions()},100)):void 0):void 0},e.prototype.getInfo=function(){return'"'+this.number+'" '+this.state+" "+this.name},e.prototype.isFiltered=function(t){return t&&"string"==typeof t?this.number&&-1!==this.number.indexOf(t)||-1!==(" "+this.name).toLowerCase().indexOf(t)?!0:!1:!0},e.prototype.getEl=function(){var e,n;return n=this.template.replace(this.regexps.name,this.nameHtml).replace(this.regexps.number,this.numberHtml).replace(this.regexps.avatarLink32x32,this.avatarLink32x32).replace(this.regexps.css,this.defaultAvatarCss),e=t(n),this.els=this.els.add(e),e.data("user",this),this.initButtonEl(e.find(".b_button_action")),e},e.prototype.initButtonEl=function(t){var e=this;return this.buttonEls=this.buttonEls.add(t),t.data("user",this),t.children(":first").bind("click",function(){return e.doAction(e.buttonLastAction)}),this.buttonLastAction?t.addClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase()):void 0},e.prototype.getButtonEl=function(){var e;return e=t(this.buttonTemplate),this.initButtonEl(e),e},e.prototype.isHovered=function(t){return this.hasHover!==t?(this.hasHover=t,this.hasHover?this.loadActions():void 0):void 0},e.prototype.loadOktellActions=function(){return this.oktell.getPhoneActions(this.id||this.number)},e.prototype.loadActions=function(){var t,e;return e=this.loadOktellActions(),y("load action for user id="+this.id+" number="+this.number+" actions="+e),window.cuser=this,t=(null!=e?e[0]:void 0)||"",this.buttonLastAction!==t?(this.buttonLastAction&&this.buttonEls.removeClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase()),t?(this.buttonLastAction=t,this.buttonEls.addClass(this.firstLiCssPrefix+this.buttonLastAction.toLowerCase())):this.buttonLastAction="",e):void 0},e.prototype.doAction=function(t){var e;if(t)switch(e=this.number,t){case"call":return this.oktell.call(e);case"conference":return this.oktell.conference(e);case"intercom":return this.oktell.intercom(e);case"transfer":return this.oktell.transfer(e);case"toggle":return this.oktell.toggle();case"ghostListen":return this.oktell.ghostListen(e);case"ghostHelp":return this.oktell.ghostHelp(e);case"ghostConference":return this.oktell.ghostConference(e);case"endCall":return this.oktell.endCall(e)}},e.prototype.doLastFirstAction=function(){return this.buttonLastAction?(this.doAction(this.buttonLastAction),!0):!1},e}(),n=function(){function n(n,i,s,o,r){var a,u,c,d=this;this.allActions={call:{icon:"/img/icons/action/call.png",iconWhite:"/img/icons/action/white/call.png",text:this.langs.call},conference:{icon:"/img/icons/action/confinvite.png",iconWhite:"/img/icons/action/white/confinvite.png",text:this.langs.conference},transfer:{icon:"/img/icons/action/transfer.png",text:this.langs.transfer},toggle:{icon:"/img/icons/action/toggle.png",text:this.langs.toggle},intercom:{icon:"/img/icons/action/intercom.png",text:this.langs.intercom},endCall:{icon:"/img/icons/action/endcall.png",iconWhite:"/img/icons/action/white/endcall.png",text:this.langs.endCall},ghostListen:{icon:"/img/icons/action/ghost_monitor.png",text:this.langs.ghostListen},ghostHelp:{icon:"/img/icons/action/ghost_help.png",text:this.langs.ghostHelp}},this.actionCssPrefix="i_",this.lastDropdownUser=!1,this.userWithGeneratedButtons={},this.debugMode=r,this.dropdownPaddingBottomLeft=3,this.dropdownOpenedOnPanel=!1,this.regexps={actionText:/\{\{actionText\}\}/,action:/\{\{action\}\}/,css:/\{\{css\}\}/},c=!1,this.usersByNumber={},this.me=!1,this.panelUsers=[],this.panelUsersFiltered=[],this.abonents={},this.hold={},this.oktell=n,e.prototype.oktell=n,this.filter=!1,this.panelEl=i,this.dropdownEl=s,this.dropdownElLiTemplate=this.dropdownEl.html(),this.dropdownEl.empty(),this.keypadEl=this.panelEl.find(".j_phone_keypad"),this.keypadIsVisible=!1,this.usersListBlockEl=this.panelEl.find(".j_main_list"),this.usersListEl=this.usersListBlockEl.find("tbody"),this.abonentsListBlock=this.panelEl.find(".j_abonents"),this.abonentsListEl=this.abonentsListBlock.find("tbody"),this.talkTimeEl=this.abonentsListBlock.find(".b_marks_time"),this.holdBlockEl=this.panelEl.find(".j_hold"),this.holdListEl=this.holdBlockEl.find("tbody"),this.queueBlockEl=this.panelEl.find(".j_queue"),this.queueListEl=this.queueBlockEl.find("tbody"),this.filterInput=this.panelEl.find("input"),this.filterClearCross=this.panelEl.find(".jInputClear_close"),a=!1,this.jScroll(this.usersListBlockEl),this.filterClearCross.bind("click",function(){return d.clearFilter()}),this.filterInput.bind("keyup",function(t){return a||(a=l(function(){return d.setFilter(d.filterInput.val())},100)),d.filterInput.val()?d.filterClearCross.show():d.filterClearCross.hide(),13===t.keyCode?(d.filterInput.blur(),setTimeout(function(){var t;return t=d.panelUsersFiltered[0],t.doLastFirstAction(),d.clearFilter()},50)):a(),!0}),this.panelEl.on("mouseenter",".b_contact",function(){var e;return null!=(e=t(this).data("user"))?e.isHovered(!0):void 0}),this.panelEl.on("mouseleave",".b_contact",function(){var e;return null!=(e=t(this).data("user"))?e.isHovered(!1):void 0}),this.panelEl.on("click",".b_contact .drop_down",function(e){var n,i;return n=t(e.currentTarget),i=n.closest(".b_button_action").data("user"),i?d.showDropdown(i,n.closest(".b_button_action"),i.loadOktellActions(),!0):void 0}),this.dropdownEl.on("click","[data-action]",function(e){var n,i,s;return i=t(e.currentTarget),n=i.data("action"),s=d.dropdownEl.data("user"),n&&s&&s.doAction(n),d.dropdownEl.hide()}),u="",this.dropdownEl.hover(function(){return clearTimeout(u)},function(){return u=setTimeout(function(){return d.dropdownEl.fadeOut(150,function(){return d.dropdownOpenedOnPanel=!1})},500)}),this.panelEl.find(".j_keypad_expand").bind("click",function(){return d.toggleKeypadVisibility(),d.filterInput.focus()}),this.keypadEl.find("li").bind("click",function(e){return d.filterInput.focus(),d.filterInput.val(d.filterInput.val()+t(e.currentTarget).find("button").data("num")),d.filterInput.keydown()}),this.setUserListHeight=function(){return d.usersListBlockEl.css({height:t(window).height()-d.usersListBlockEl[0].offsetTop+"px"})},this.setUserListHeight(),n.on("disconnect",function(){return c=!1}),n.on("connect",function(){var t,i,s,a,l,u,h,p;c=!0,i=n.getMyInfo(),i.userid=(""+i.userid).toLowerCase(),d.myNumber=null!=(h=i.number)?""+h:void 0,e.prototype.defaultAvatar=i.defaultAvatar,e.prototype.defaultAvatar32=i.defaultAvatar32x32,e.prototype.defaultAvatar64=i.defaultAvatar64x64,a=n.getUsers();for(t in a)s=a[t],l=(null!=(p=s.number)?""+p:void 0)||"",d.usersByNumber[l]?(u=d.usersByNumber[l],u.init(s)):(u=new e(s),u.number&&(d.usersByNumber[u.number]=u)),u.id!==i.userid?d.panelUsers.push(u):d.me=u;return d.sortPanelUsers(d.panelUsers),n.on("stateChange",function(){return d.reloadActions()}),n.onNativeEvent("pbxnumberstatechanged",function(t){var e,n,i,s,o,r,a;for(o=t.numbers,a=[],i=0,s=o.length;s>i;i++)e=o[i],n=""+e.num,a.push(null!=(r=d.usersByNumber[n])?r.setState(e.numstateid):void 0);return a}),n.on("abonentsChange",function(t){return d.setAbonents(t)}),n.on("holdStateChange",function(t){return d.setHold(t)}),n.on("talkTimer",function(t,e){return t===!1?d.talkTimeEl.text(""):d.talkTimeEl.text(e)}),d.setAbonents(n.getAbonents()),d.setHold(n.getHoldInfo()),d.setFilter(""),setInterval(function(){return c?n.getQueue(function(t){return t.result?d.setQueue(t.queue):void 0}):void 0},r?999999999:5e3),"function"==typeof o?o():void 0})}return n.prototype.getUserButtonForPlagin=function(t){var e,n,i=this;return n=this.getUser(t),this.userWithGeneratedButtons[t]=n,e=n.getButtonEl(),e.find(".drop_down").bind("click",function(){return i.showDropdown(n,e,n.loadOktellActions())}),e},n.prototype.clearFilter=function(){return this.filterInput.val(""),this.setFilter(""),this.filterInput.keyup()},n.prototype.toggleKeypadVisibility=function(){return this.setKeypadVisibility(!this.keypadIsVisible)},n.prototype.setKeypadVisibility=function(t){return null!=t&&Boolean(this.keypadIsVisible)!==Boolean(t)?(this.keypadIsVisible=Boolean(t),this.keypadEl.stop(!0,!0),this.keypadIsVisible?this.keypadEl.slideDown(200,this.setUserListHeight):this.keypadEl.slideUp(200,this.setUserListHeight)):void 0},n.prototype.addEventListenersForButton=function(e,n){var i=this;return n.bind("click",function(){return e?i.showDropdown(e,t(i)):void 0})},n.prototype.showDropdown=function(e,n,i,s){var o,r,a,l,u,c;if(a=this.dropdownElLiTemplate,this.dropdownEl.empty(),null!=i?!i.length:true)return this.dropdownEl.hide();for(r=[],l=0,u=i.length;u>l;l++)o=i[l],"string"==typeof o&&(null!=(c=this.allActions[o])?c.text:void 0)&&r.push(a.replace(this.regexps.actionText,this.allActions[o].text).replace(this.regexps.action,o).replace(this.regexps.css,this.actionCssPrefix+o.toLowerCase()));return r.length?(this.dropdownEl.append(r),this.dropdownEl.children("li:first").addClass("g_first"),this.dropdownEl.children("li:last").addClass("g_last"),this.dropdownEl.data("user",e),this.dropdownEl.css({top:this.dropdownEl.height()+n.offset().top>t(window).height()?t(window).height()-this.dropdownEl.height()-this.dropdownPaddingBottomLeft:n.offset().top,left:Math.max(this.dropdownPaddingBottomLeft,n.offset().left-this.dropdownEl.width()+n.width()),visibility:"visible"}),this.dropdownEl.fadeIn(100),s?this.dropdownOpenedOnPanel=!0:void 0):this.dropdownEl.hide()},n.prototype.logUsers=function(){var t,e,n,i;n=this.panelUsersFiltered,i=[];for(t in n)e=n[t],i.push(y(e.getInfo()));return i},n.prototype.syncAbonentsAndUserlist=function(e,n){var i,s,o,r,a=this;i={},t.each(e,function(t,e){var s,o;return(s=""+e.phone||"")?(i[s]=e,n[""+e.phone]?void 0:(o=a.getUser({name:e.name,number:e.phone,id:e.userid,state:5}),n[o.number]=o)):void 0}),r=[];for(s in n)o=n[s],i[o.number]?r.push(void 0):r.push(delete n[o.number]);return r},n.prototype.setAbonents=function(t){return this.syncAbonentsAndUserlist(t,this.abonents),this.setAbonentsHtml()},n.prototype.setQueue=function(t){return this.syncAbonentsAndUserlist(t,this.queue),this.setQueueHtml()},n.prototype.setHold=function(t){var e;return e=[],t.hasHold&&(e=[t.abonent]),this.syncAbonentsAndUserlist(e,this.hold),this.setHoldHtml()},n.prototype.setPanelUsersHtml=function(t){return this._setUsersHtml(t,this.usersListEl)},n.prototype.setAbonentsHtml=function(){return this._setActivityPanelUserHtml(this.abonents,this.abonentsListEl,this.abonentsListBlock)},n.prototype.setHoldHtml=function(){return this._setActivityPanelUserHtml(this.hold,this.holdListEl,this.holdBlockEl)},n.prototype.setQueueHtml=function(){return this._setActivityPanelUserHtml(this.queue,this.queueListEl,this.queueBlockEl)},n.prototype._setActivityPanelUserHtml=function(t,e,n){var i,s,o;o=[];for(i in t)s=t[i],o.push(s);return this._setUsersHtml(o,e),o.length&&n.is(":not(:visible)")?n.slideDown(200,this.setUserListHeight):0===o.length&&n.is(":visible")?n.slideUp(200,this.setUserListHeight):void 0},n.prototype._setUsersHtml=function(t,e){var n,i,s,o;for(n=[],s=0,o=t.length;o>s;s++)i=t[s],n.push(i.getEl());return e.html(n)},n.prototype.sortPanelUsers=function(t){return t.sort(function(t,e){return t.number&&!e.number?-1:!t.number&&e.number?1:t.state&&!e.state?-1:!t.state&&e.state?1:t.name>e.name?1:t.name<e.name?-1:void 0})},n.prototype.setFilter=function(t){var e,n,i,s,o,r,a,l;if(this.filter===t)return!1;if(s=this.filter,this.filter=t,""===t)return this.panelUsersFiltered=[].concat(this.panelUsers),this.afterSetFilter(this.panelUsersFiltered),this.panelUsersFiltered;for(n=[],e=!1,i=0===s.indexOf(this.filter)?this.panelUsersFiltered:this.panelUsers,l=this.panelUsers,r=0,a=l.length;a>r;r++)o=l[r],o.isFiltered(t)&&(n.push(o),o.number!==t||e||(e=o));return this.panelUsersFiltered=e?n:[this.getUser({name:t,number:t},!0)].concat(n),this.afterSetFilter(this.panelUsersFiltered),this.panelUsersFiltered},n.prototype.afterSetFilter=function(t){return this.setPanelUsersHtml(t)},n.prototype.getUser=function(t,n){var i,s;return s="string"==typeof t||"number"==typeof t?""+t:""+t.number,this.usersByNumber[s]?(this.usersByNumber[s].init(t),this.usersByNumber[s]):(i=new e({number:s,name:t.name,isFantom:!0,state:null!=(null!=t?t.state:void 0)?t.state:5}),n||(this.usersByNumber[s]=i),i)},n.prototype.reloadActions=function(){var t=this;return setTimeout(function(){var e,n,i,s,o;s=t.userWithGeneratedButtons,o=[];for(n in s)i=s[n],e=i.loadActions(),o.push(y("reload actions for "+i.getInfo()+" "+e));return o},100)},n}(),_=function(e){var n;return null!=C[e]?C[e]:(n="",t.ajax({url:e,async:!1,success:function(t){return n=t}}),n)},i=_("/templates/actionButton.html"),u={position:"right",dynamic:!0,animateTimout:200,oktell:window.oktell,buttonCss:"oktellActionButton",debug:!1},g={panel:{inTalk:"В разговоре",onHold:"На удержании",queue:"Очередь ожидания",inputPlaceholder:"введите имя или номер"},actions:{call:"Позвонить",conference:"Конференция",transfer:"Перевести",toggle:"Переключиться",intercom:"Интерком",endCall:"Завершить",ghostListen:"Прослушка",ghostHelp:"Помощь"}},E=null,s=null,w=null,k=!1,a=null,v=null,h=function(){return E||u},o=_("/templates/actionList.html"),n.prototype.langs=g.actions,n.prototype.jScroll=m,H=_("/templates/user.html"),e.prototype.template=H.replace("<!--button-->",i),e.prototype.buttonTemplate=i,L=_("/templates/panel.html"),L=L.replace("{{inTalk}}",g.panel.inTalk).replace("{{onHold}}",g.panel.onHold).replace("{{queue}}",g.panel.queue).replace("{{inputPlaceholder}}",g.panel.inputPlaceholder),x=t(L),A=!1,b=function(e){var r,l,c,d,p,f,b,m,g,_,y,k,L,C,B,U,j,T,I,P,F,O;return A=!0,E=t.extend(u,e||{}),r=t(H),l=t(i),C=l.attr("data-bind"),l.attr("data-bind",C+", visible: $data.actionBarIsVisible"),r.find("td.b_contact_title").append(l),s=t(o),t("body").append(s),w=h().oktell,T=h().position,d={},d[T]="0px",c={},c[T]="-281px",t("body").append(x),v=new n(w,x,s,a,h().debug),window.list=v,"right"===T?x.addClass("right"):"left"===T&&x.addClass("left"),h().dynamic&&x.addClass("dynamic"),U=x.find(".i_panel_bookmark"),k=!1,j=!1,I="closed",y=function(){return clearTimeout(j),j=!1},x.on("mouseenter",function(){return k=!0,y(),0>parseInt(x.css(T))&&("closed"===I||"closing"===I)&&(I="opening",U.stop(!0,!0),U.animate({left:"0px"},50,"swing"),x.stop(!0,!0),x.animate(d,100,"swing",function(){return x.addClass("g_hover"),I="open"})),!0}),_=function(){return x.hasClass("g_hover")?(I="closing",x.stop(!0,!0),x.animate(c,300,"swing",function(){return x.css({panelPos:0}),x.removeClass("g_hover"),I="closed"}),setTimeout(function(){return U.animate({left:"-40px"},50,"swing")},150)):void 0},x.on("mouseleave",function(){return k=!1,!0}),t("html").on("mouseleave",function(){return y(),!0}),t("html").on("mousemove",function(){return k||j!==!1||v.dropdownOpenedOnPanel||(j=setTimeout(function(){return _()},100)),!0}),-1!==window.navigator.userAgent.indexOf("iPad")&&(O=0,F=0,m=x,g=0,f=0,b=-281,P=0,L=0,B="j_open",p="j_close",0>parseInt(m[0].style.right)&&m.addClass(p),m.live("click",function(){return m.hasClass(p)?m.animate(d,200,"swing",function(){return m.removeClass(p).addClass(B),P=0}):void 0}),m.live("touchstart",function(t){return O=t.originalEvent.touches[0].pageX,g=m.width(),f=13*(g/100),b=parseInt(m.css(T))}),m.bind("touchmove",function(t){return t.preventDefault(),F=t.originalEvent.touches[0].pageX,P=F-O,L=b-P,-281>L?L=-281:L>0&&(L=0),m[0].style.right=L+"px"}),m.bind("touchend",function(){return P>=f&&0>P?m.animate(c,200,"swing"):void 0}),-1*P>=f&&P>0&&m.animate(d,200,"swing"),f>P&&0>P&&m.animate(d,100,"swing",function(){return m.removeClass(p).addClass(B)}),f>-1*P&&P>0)?m.animate(c,100,"swing",function(){return m.removeClass(B).addClass(p)}):void 0},c=[],a=function(){var t,e,n;for(k=!0,e=0,n=c.length;n>e;e++)t=c[e],r(t);return c=[]},f=function(t){var e,n;return t.addClass(h().buttonCss),n=t.attr("data-phone"),n?(e=v.getUserButtonForPlagin(n),y("generated button for "+n,e),t.html(e)):void 0},r=function(t){return f(t)},p=function(e){return t(e+":not(."+actionButtonContainerClass+")").each(function(){return r(t(this))})},t.oktellPanel=function(t){if("string"==typeof t){if(A)return p(t)}else if(!A)return b(t)},t.fn.oktellButton=function(){return t(this).each(function(){return r(t(this))})}})($);